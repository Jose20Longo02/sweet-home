document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("np-data");let t={};try{t=JSON.parse(e.getAttribute("data-locations")||"{}")}catch(e){t={}}const n=e.getAttribute("data-default-city")||"",o=e.getAttribute("data-default-hood")||"",d=document.getElementById("country"),i=document.getElementById("city"),l=document.getElementById("neighborhood"),r=document.getElementById("type"),a=document.getElementById("is_in_project"),s=document.getElementById("projectWrap"),c=document.getElementById("project_id");function u(){const e=Object.keys(t[d.value]||{});i.innerHTML='<option value="">Select city</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n===e&&(t.selected=!0),i.appendChild(t)}),i.disabled=0===e.length,m()}function m(){const e=(t[d.value]||{})[i.value]||[];l.innerHTML='<option value="">Select neighborhood (optional)</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,o===e&&(t.selected=!0),l.appendChild(t)}),l.disabled=0===e.length}function y(){const e=r.value;[{id:"typeApartment",active:"Apartment"===e},{id:"typeHouseVilla",active:"House"===e||"Villa"===e},{id:"typeLand",active:"Land"===e}].forEach(({id:e,active:t})=>{const n=document.getElementById(e);n&&(n.hidden=!t,n.querySelectorAll("input, select, textarea").forEach(e=>{e.disabled=!t}))});const t="Apartment"===e,n="House"===e||"Villa"===e,o="Land"===e,d=document.getElementById("apartment_size"),i=document.getElementById("rooms_a"),l=document.getElementById("bathrooms_a");d&&(d.required=t),i&&(i.required=t),l&&(l.required=t);const a=document.getElementById("total_size"),s=document.getElementById("rooms_hv"),c=document.getElementById("bathrooms_hv");a&&(a.required=n),s&&(s.required=n),c&&(c.required=n);const u=document.getElementById("land_size");u&&(u.required=o)}function g(){const e=!!a.checked;s.hidden=!e,c.required=e,c.disabled=!e,e||(c.value="")}function p(){const e=(r.value||"").toLowerCase(),t=document.getElementById("featuresSection");if(t){const n="land"===e;t.hidden=n,t.querySelectorAll('input[type="checkbox"][name="features"]').forEach(e=>{e.disabled=n})}}function f(){const e=(r.value||"").toLowerCase(),t=document.getElementById("yearBuiltField"),n=document.getElementById("year_built"),o="land"===e;t&&(t.hidden=o),n&&(n.disabled=o)}function v(){const e=document.getElementById("rental_status"),t=document.getElementById("rentalIncomeWrap"),n=document.getElementById("rental_income"),o=e&&e.value||"",d="rented"===o||"not_rented_potential"===o;t&&(t.hidden=!d),n&&(n.disabled=!d)}d.addEventListener("change",u),i.addEventListener("change",m),r.addEventListener("change",y),a.addEventListener("change",g),u(),n&&(i.value=n),m(),y(),g(),p(),r.addEventListener("change",p);const E=document.getElementById("rental_status");E&&E.addEventListener("change",v),f(),r.addEventListener("change",f),v(),document.addEventListener("click",function(e){const t=e.target.closest("[data-remove-photo]");if(t){const e=t.getAttribute("data-remove-photo"),n=document.getElementById("remove_existing_photos");if(n){const t=n.value?n.value.split("\n"):[];t.includes(e)||t.push(e),n.value=t.join("\n")}const o=t.closest(".item");o&&o.remove(),window.persistPhotoOrder&&"function"==typeof window.persistPhotoOrder&&window.persistPhotoOrder()}if(e.target.closest("[data-remove-video]")){const e=document.getElementById("remove_existing_video");e&&(e.value="true");const t=document.getElementById("videoPreview");t&&(t.innerHTML="")}});const h=document.getElementById("price"),b=document.getElementById("price_display"),I=new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:2}),B=e=>{if("string"!=typeof e)return null;const t=e.replace(/[^0-9,\.]/g,"").replace(/,/g,".");if(!t)return null;const n=Number(t);return Number.isNaN(n)?null:n};if(h&&h.value){const e=Number(h.value);Number.isNaN(e)||(b.value=I.format(e))}b.addEventListener("input",()=>{const e=B(b.value);h.value=null!==e?String(e.toFixed(2)):""}),b.addEventListener("blur",()=>{const e=B(b.value);if(null===e)return b.value="",void(h.value="");b.value=I.format(e),h.value=String(e.toFixed(2))}),function(){const e=document.getElementById("propertyForm");if(!e)return;let t=!1;e.addEventListener("submit",function(){if(t)return!1;if(!e.checkValidity())return!0;try{const e=(document.getElementById("type")?.value||"").toLowerCase(),t=document.getElementById("remove_existing_floorplan"),n=document.getElementById("remove_existing_plan_photo"),o=document.getElementById("floorplan"),d=document.getElementById("floorplanPreview"),i=document.getElementById("plan_photo_hv"),l=document.getElementById("planPhotoPreviewHV"),r=document.getElementById("plan_photo"),a=document.getElementById("planPhotoPreview");if("apartment"===e&&t){const e=d&&!d.querySelector(".item"),n=!o||!o.files||0===o.files.length;e&&n&&(t.value="true")}if(("house"===e||"villa"===e)&&n){const e=l&&!l.querySelector(".item"),t=!i||!i.files||0===i.files.length;e&&t&&(n.value="true")}if("land"===e&&n){const e=a&&!a.querySelector(".item"),t=!r||!r.files||0===r.files.length;e&&t&&(n.value="true")}}catch(e){}t=!0;const n=document.getElementById("uploadOverlay");if(n)try{n.parentNode!==document.body&&document.body.appendChild(n),n.style.position="fixed",n.style.inset="0",n.style.zIndex="20000",n.style.display="flex",n.hidden=!1}catch(e){n.hidden=!1,n.style.display="flex"}const o=e.querySelector('button[type="submit"]');o&&(o.disabled=!0,o.dataset.originalText=o.textContent||"",o.textContent="Uploading...")},{capture:!0})}(),function(){const e=document.getElementById("photos"),t=document.getElementById("photoPreview"),n=document.getElementById("orderedExistingPhotos");function o(){t.querySelectorAll('.item[data-new="1"]').forEach(e=>e.remove());Array.from(e.files||[]).forEach(n=>{const d=URL.createObjectURL(n),i=document.createElement("div");i.className="item",i.setAttribute("data-new","1"),i.dataset.fileName=n.name,i.dataset.fileSize=String(n.size),i.dataset.fileLastMod=String(n.lastModified),i.style.position="relative";const l=document.createElement("img");l.src=d,l.className="thumb";const r=document.createElement("button");r.type="button",r.textContent="×",r.setAttribute("aria-label","Remove"),r.style.position="absolute",r.style.right="6px",r.style.top="6px",r.style.width="24px",r.style.height="24px",r.style.borderRadius="50%",r.style.border="none",r.style.background="rgba(0,0,0,0.6)",r.style.color="#fff",r.style.cursor="pointer",r.addEventListener("click",function(){const t=Array.from(e.files||[]),d=t.findIndex(e=>e.name===n.name&&e.size===n.size&&e.lastModified===n.lastModified);if(d>=0){t.splice(d,1);const n=new DataTransfer;t.forEach(e=>n.items.add(e)),e.files=n.files,o()}else i.remove()}),i.appendChild(l),i.appendChild(r),t.appendChild(i)})}function d(){const e=Array.from(t.querySelectorAll(".item"));e.forEach((t,n)=>{t.draggable=!0,t.addEventListener("dragstart",()=>{t.classList.add("dragging"),t.dataset.dragIndex=String(n)}),t.addEventListener("dragend",()=>{t.classList.remove("dragging"),delete t.dataset.dragIndex,i()}),t.addEventListener("dragover",e=>{e.preventDefault()}),t.addEventListener("drop",n=>{n.preventDefault();const o=e.findIndex(e=>e.classList.contains("dragging")),l=e.indexOf(t);if(-1===o||-1===l||o===l)return;const r=t.parentNode,a=e[o];o<l?r.insertBefore(a,t.nextSibling):r.insertBefore(a,t),d(),i()})})}function i(){if(!n)return;n.innerHTML="";const o=document.getElementById("remove_existing_photos"),d=o&&o.value?o.value.split("\n").filter(Boolean):[];Array.from(t.querySelectorAll(".item")).forEach(t=>{const o=t.querySelector("img.thumb");if(!o)return;const i=document.createElement("input");if(i.type="hidden",i.name="photos_order","1"===t.getAttribute("data-new")){const n=Array.from(e.files||[]).findIndex(e=>String(e.name)===t.dataset.fileName&&String(e.size)===t.dataset.fileSize&&String(e.lastModified)===t.dataset.fileLastMod);if(!(n>=0))return;i.value="file:"+n}else{const e=o.getAttribute("src");if(!e)return;if(d.includes(e))return;i.value="url:"+e}n.appendChild(i)})}e&&t&&(d(),i(),e.addEventListener("change",()=>{o(),d(),i()}),window.persistPhotoOrder=i)}(),function(){const e=document.getElementById("videoSrcUpload"),t=document.getElementById("videoSrcLink"),n=document.getElementById("videoUploadWrap"),o=document.getElementById("videoUrlWrap"),d=document.getElementById("video"),i=document.getElementById("video_url"),l=document.getElementById("videoPreview"),r=document.getElementById("remove_existing_video");function a(){const t=!(!e||!e.checked);n&&(n.hidden=!t),o&&(o.hidden=t),t?(i&&(i.value="",i.disabled=!0),d&&(d.disabled=!1)):(d&&(d.value="",d.disabled=!0),i&&(i.disabled=!1),l&&(l.innerHTML=""))}e&&e.addEventListener("change",a),t&&t.addEventListener("change",a),a(),d&&l&&d.addEventListener("change",()=>{if(l.innerHTML="",d.files&&d.files[0]){const e=URL.createObjectURL(d.files[0]),t=document.createElement("div");t.style.position="relative",t.style.display="inline-block";const n=document.createElement("video");n.src=e,n.controls=!0,n.playsInline=!0,n.style.maxWidth="100%";const o=document.createElement("button");o.type="button",o.textContent="×",o.setAttribute("aria-label","Remove video"),o.style.position="absolute",o.style.right="6px",o.style.top="6px",o.style.width="24px",o.style.height="24px",o.style.borderRadius="50%",o.style.border="none",o.style.background="rgba(0,0,0,0.6)",o.style.color="#fff",o.style.cursor="pointer",o.addEventListener("click",function(){d.value="",l.innerHTML="",r&&(r.value="false")}),t.appendChild(n),t.appendChild(o),l.appendChild(t),r&&(r.value="true")}})}()});