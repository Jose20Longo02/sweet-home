document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("cover"),t=document.getElementById("coverPreview"),n=document.getElementById("coverPlaceholder");e&&e.addEventListener("change",function(){var r=this.files&&this.files[0];if(!r)return t&&(t.style.display="none",t.src=""),n&&(n.style.display="block"),void((a=document.querySelector(".file-error"))&&a.remove());var i=r.type.toLowerCase(),o=r.name.split(".").pop().toLowerCase();if(!(["image/jpeg","image/jpg","image/png","image/webp","image/heic","image/heif"].includes(i)||["heic","heif"].includes(o)))return(l=document.createElement("div")).className="file-error",l.style.cssText="color: #dc2626; font-size: 0.875rem; margin-top: 0.5rem; padding: 0.5rem; background: #fee2e2; border-radius: 4px;",l.textContent="Invalid file type. Only JPEG, PNG, WebP, HEIC, and HEIF images are supported.",e.parentNode.appendChild(l),e.value="",t&&(t.style.display="none",t.src=""),void(n&&(n.style.display="block"));var l,a;if(r.size>20971520)return(l=document.createElement("div")).className="file-error",l.style.cssText="color: #dc2626; font-size: 0.875rem; margin-top: 0.5rem; padding: 0.5rem; background: #fee2e2; border-radius: 4px;",l.innerHTML='File too large. Maximum file size is 20 MB. Please compress or resize your image. <a href="https://www.iloveimg.com/compress-image" target="_blank" style="color: #0066cc; text-decoration: underline;">Use an online compressor</a>.',e.parentNode.appendChild(l),e.value="",t&&(t.style.display="none",t.src=""),void(n&&(n.style.display="block"));(a=document.querySelector(".file-error"))&&a.remove();var d=URL.createObjectURL(r);t&&(t.src=d,t.onload=function(){URL.revokeObjectURL(d)},t.style.display="block"),n&&(n.style.display="none")});var r=document.getElementById("editor"),i=document.getElementById("content");if(r&&window.Quill){var o=new Quill("#editor",{theme:"snow",placeholder:"Write your article here...",modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{align:[]}],[{list:"ordered"},{list:"bullet"}],["link","image"],["clean"]]}});try{r.style.display=""}catch(e){}i&&i.value&&o.clipboard.dangerouslyPasteHTML(i.value),i&&(i.style.display="none");var l=i&&i.form;l&&l.addEventListener("submit",function(){i.value=o.root.innerHTML});var a=o.getModule("toolbar");a&&a.addHandler("image",function(){var e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.onchange=function(){var t=e.files&&e.files[0];if(t){var n=new FormData;n.append("image",t);var r=document.querySelector('input[name="title"]');r&&r.value&&n.append("title",r.value);var i=document.querySelector('input[name="_csrf"]'),l=i?i.value:"";fetch("/admin/dashboard/blog/api/inline-image",{method:"POST",headers:{"x-csrf-token":l},body:n}).then(function(e){return e.json()}).then(function(e){if(e&&e.url){var t=o.getSelection(!0);o.insertEmbed(t.index,"image",e.url,"user"),o.setSelection(t.index+1)}}).catch(function(e){console.error("Upload failed",e)})}},e.click()})}document.querySelectorAll('form[method="post"]').forEach(e=>{let t=!1;e.addEventListener("submit",function(n){if(t)return n.preventDefault(),!1;var r=e.querySelector('input[name="title"]');if(r&&!r.value.trim())return n.preventDefault(),alert("Please enter a title for your blog post."),r.focus(),!1;var i=e.querySelector('input[name="cover"]');if(i&&i.files&&i.files[0]&&i.files[0].size>20971520)return n.preventDefault(),alert("File too large. Maximum file size is 20 MB. Please compress or resize your image before uploading."),!1;if(!e.checkValidity())return n.preventDefault(),!1;t=!0;const o=document.getElementById("uploadOverlay");o&&(o.hidden=!1,o.style.display="flex");const l=e.querySelector('button[type="submit"]');if(l)if(l.disabled=!0,l.dataset.originalText=l.textContent||"",e.action.includes("/delete")){if(l.textContent="Deleting...",o){const e=o.querySelector(".upload-title");e&&(e.textContent="Deleting Post...")}}else if(e.action.includes("/edit")||e.action.includes("/update")){if(l.textContent="Saving...",o){const e=o.querySelector(".upload-title");e&&(e.textContent="Saving Changes...")}}else if(l.textContent="Creating...",o){const e=o.querySelector(".upload-title");e&&(e.textContent="Creating Post...")}},{capture:!0})})});