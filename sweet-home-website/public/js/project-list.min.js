function initializeProjectList(){initializeFilters(),initializeSearch(),initializeSorting(),initializePagination(),initializeProjectCards();const e=document.getElementById("projectsGrid");e&&e.addEventListener("click",e=>{const t=e.target.closest("[data-open-units]");if(t){const e=t.getAttribute("data-open-units");return void(e&&openUnitTypes(e))}const n=e.target.closest(".project-card");if(n){const e=n.getAttribute("data-project-slug");e&&(window.location.href=`/projects/${e}`)}}),bindEuroFilter("minUnitPriceDisplay","minUnitPrice"),bindEuroFilter("maxUnitPriceDisplay","maxUnitPrice");const t=document.querySelector(".mobile-filters-trigger");t&&t.addEventListener("click",e=>{e.preventDefault(),toggleMobileFilters(!0)});const n=document.querySelector(".filters-close");n&&n.addEventListener("click",e=>{e.preventDefault(),toggleMobileFilters(!1)});const o=document.getElementById("filtersOverlay");o&&o.addEventListener("click",()=>toggleMobileFilters(!1))}function initializeFilters(){document.addEventListener("click",function(e){e.target.closest(".clear-filters")&&(e.preventDefault(),clearAllFilters())}),initializeLocationCascading(),window.toggleMobileFilters=function(e){const t=document.getElementById("filtersSidebar"),n=document.getElementById("filtersOverlay");t&&(e?(t.classList.add("open"),t.setAttribute("aria-hidden","false"),n&&n.classList.add("open"),document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden"):(t.classList.remove("open"),t.setAttribute("aria-hidden","true"),n&&n.classList.remove("open"),document.documentElement.style.overflow="",document.body.style.overflow=""))}}function initializeLocationCascading(){const e=document.getElementById("country")||document.getElementById("filterCountry"),t=document.getElementById("city")||document.getElementById("filterCity"),n=document.getElementById("neighborhood")||document.getElementById("filterNeighborhood");if(!e||!t||!n)return;const o=getLocationsData();e&&"country"===e.id&&populateCountries(e,o),e.addEventListener("change",function(){const e=this.value;populateCities(t,o,e),n.innerHTML='<option value="">All Neighborhoods</option>'}),t.addEventListener("change",function(){const t=this.value;populateNeighborhoods(n,o,e.value,t)}),n.addEventListener("change",function(){})}function getLocationsData(){const e=document.getElementById("locations-data");if(!e)return{};try{return JSON.parse(e.dataset.locations)}catch(e){return console.error("Error parsing locations data:",e),{}}}function populateCountries(e,t){e.innerHTML='<option value="">All Countries</option>',Object.keys(t).forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)})}function populateCities(e,t,n){e.innerHTML='<option value="">All Cities</option>',n&&t[n]&&Object.keys(t[n]).forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)})}function populateNeighborhoods(e,t,n,o){e.innerHTML='<option value="">All Neighborhoods</option>',n&&o&&t[n]&&t[n][o]&&t[n][o].forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)})}function applyFilters(){const e=document.getElementById("project-filters")||document.getElementById("filtersForm");e&&"function"==typeof e.submit&&e.submit()}function fetchFilteredResults(e){showLoadingState(),fetch(`/api/projects?${e.toString()}`).then(e=>e.json()).then(e=>{updateProjectResults(e),updateActiveFilters(),hideLoadingState()}).catch(e=>{console.error("Error fetching filtered results:",e),hideLoadingState(),showErrorMessage("Error loading results. Please try again.")})}function clearAllFilters(){window.location.href="/projects"}function initializeSearch(){const e=document.querySelector(".quick-search-form");if(!e)return;e.addEventListener("submit",function(e){e.preventDefault();const t=this.querySelector('input[name="q"]').value.trim();if(t){const e=document.getElementById("search-query");e&&(e.value=t),applyFilters()}});document.querySelectorAll('input[name="q"], #search-query').forEach(e=>{e.addEventListener("input",debounce(function(){(this.value.trim().length>=2||0===this.value.trim().length)&&applyFilters()},500))})}function initializeSorting(){const e=document.getElementById("sortBy")||document.getElementById("sort");e&&e.addEventListener("change",function(){if("function"==typeof window.updateSort)return void window.updateSort();const t=new URL(window.location);t.searchParams.set("sort",e.value),t.searchParams.delete("page"),window.location.href=t.toString()})}function initializePagination(){const e=document.querySelector(".pagination");e&&e.addEventListener("click",function(e){const t=e.target.closest(".page-link");if(!t)return;const n=t.dataset.page;if(n){e.preventDefault();const t=parseInt(n,10);return void(Number.isNaN(t)||goToPage(t))}const o=t.getAttribute("href");if(!o||"#"===o){e.preventDefault();try{const e=new URL(t.href||window.location.href),n=parseInt(e.searchParams.get("page")||"",10);Number.isNaN(n)||goToPage(n)}catch(e){}}})}function goToPage(e){const t=new URL(window.location);t.searchParams.set("page",e),window.history.pushState({},"",t),showLoadingState(),fetchFilteredResults(t.searchParams)}function initializeProjectCards(){document.querySelectorAll(".project-card").forEach(e=>{e.addEventListener("click",function(){this.dataset.projectId;const e=this.dataset.projectSlug;e&&(window.location.href=`/projects/${e}`)}),e.addEventListener("mouseenter",function(){this.style.transform="translateY(-4px)"}),e.addEventListener("mouseleave",function(){this.style.transform="translateY(0)"})})}function updateProjectResults(e){const t=document.querySelector(".projects-container");t&&(e.projects&&e.projects.length>0?(updateResultsCount(e.total,e.projects.length),renderProjects(e.projects),updatePagination(e.currentPage,e.totalPages,e.total),t.style.display="block"):showNoResults())}function renderProjects(e){const t=document.querySelector(".projects-grid");t&&(t.innerHTML="",e.forEach(e=>{const n=createProjectCard(e);t.appendChild(n)}),initializeProjectCards())}function createProjectCard(e){const t=document.createElement("div");t.className="project-card",t.dataset.projectId=e.id,t.dataset.projectSlug=e.slug;const n=e.photos&&e.photos.length>0?`/uploads/projects/${e.id}/${e.photos[0]}`:"/images/placeholder-project.jpg",o=getCompletionStatus(e.completion_date),i=e.type||"Development";return t.innerHTML=`\n    <div class="project-image">\n      <img src="${n}" alt="${e.title}" loading="lazy">\n      <div class="project-badges">\n        <span class="badge badge-type">${i}</span>\n        ${o?`<span class="badge badge-completion">${o}</span>`:""}\n      </div>\n    </div>\n    <div class="project-content">\n      <h3 class="project-title">${e.title}</h3>\n      <div class="project-location">\n        <i class="fas fa-map-marker-alt"></i>\n        <span>${e.city}, ${e.country}</span>\n      </div>\n      <div class="project-details">\n        ${e.total_units?`<div class="detail-item"><i class="fas fa-building"></i><span>${e.total_units} units</span></div>`:""}\n        ${e.completion_date?`<div class="detail-item"><i class="fas fa-calendar"></i><span>${e.completion_date}</span></div>`:""}\n      </div>\n      <p class="project-description">${truncateText(e.description,120)}</p>\n      <div class="project-footer">\n        <button class="btn btn-outline btn-sm">View Details</button>\n      </div>\n    </div>\n  `,t}function openUnitTypes(e){const t=document.querySelector(`.project-card[data-project-id="${e}"]`);let n=[];try{n=JSON.parse(t?.dataset.unitTypes||"[]")}catch(e){n=[]}const o=document.getElementById("unit-types-modal");o&&o.remove();const i=document.createElement("div");i.id="unit-types-modal",i.style.position="fixed",i.style.inset="0",i.style.background="rgba(0,0,0,0.45)",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.zIndex="2000";const r=document.createElement("div");r.style.background="#fff",r.style.borderRadius="12px",r.style.boxShadow="0 20px 40px rgba(0,0,0,0.2)",r.style.width="min(92vw, 420px)",r.style.padding="20px";const a=document.createElement("h3");a.textContent="Unit Types",a.style.margin="0 0 12px 0",r.appendChild(a);const s=document.createElement("ul");s.style.margin="0",s.style.padding="0 0 10px 18px",s.style.color="#334155",(n.length?n:["Villas","Apartments","Houses"]).forEach(e=>{const t=document.createElement("li");t.textContent=e,s.appendChild(t)}),r.appendChild(s);const c=document.createElement("button");c.className="btn btn-primary",c.textContent="Close",c.style.marginTop="8px",c.addEventListener("click",()=>i.remove()),r.appendChild(c),i.addEventListener("click",e=>{e.target===i&&i.remove()}),i.appendChild(r),document.body.appendChild(i)}function getCompletionStatus(e){if(!e)return null;const t=new Date,n=new Date(e);return n<t?"Completed":n.getTime()-t.getTime()<2592e6?"Soon":"In Progress"}function truncateText(e,t){return!e||e.length<=t?e:e.substring(0,t)+"..."}function updateActiveFilters(){const e=document.querySelector(".active-filters");if(!e)return;const t=document.getElementById("project-filters");if(!t)return;const n=new FormData(t),o=[];for(let[e,t]of n.entries())t&&""!==t.trim()&&"page"!==e&&o.push({key:e,value:t});renderActiveFilters(e,o)}function renderActiveFilters(e,t){if(0===t.length)return void(e.innerHTML="");const n=t.map(e=>`\n    <span class="filter-tag">\n      ${getFilterDisplayName(e.key)}: ${e.value}\n      <button class="filter-remove" data-filter-key="${e.key}" data-filter-value="${e.value}">√ó</button>\n    </span>\n  `).join("");e.innerHTML=`\n    <span class="active-filters-label">Active filters:</span>\n    ${n}\n  `;e.querySelectorAll(".filter-remove").forEach(e=>{e.addEventListener("click",function(){removeFilter(this.dataset.filterKey,this.dataset.filterValue)})})}function getFilterDisplayName(e){return{q:"Search",country:"Country",city:"City",neighborhood:"Neighborhood",type:"Type",sort:"Sort"}[e]||e}function removeFilter(e,t){const n=document.getElementById("project-filters");if(!n)return;const o=n.querySelector(`[name="${e}"]`);o&&("checkbox"===o.type?o.checked=!1:o.value="",applyFilters())}function updateResultsCount(e,t){const n=document.querySelector(".results-info p");n&&(n.textContent=`Showing ${t} of ${e} projects`)}function updatePagination(e,t,n){const o=document.querySelector(".pagination");if(!o)return;if(t<=1)return void(o.style.display="none");o.style.display="flex";let i="";e>1&&(i+=`<a href="#" class="page-link" data-page="${e-1}">Previous</a>`);for(let n=1;n<=t;n++)n===e?i+=`<span class="page-link active">${n}</span>`:1===n||n===t||n>=e-2&&n<=e+2?i+=`<a href="#" class="page-link" data-page="${n}">${n}</a>`:n!==e-3&&n!==e+3||(i+='<span class="page-link">...</span>');e<t&&(i+=`<a href="#" class="page-link" data-page="${e+1}">Next</a>`),o.innerHTML=i}function showNoResults(){const e=document.querySelector(".projects-container");e&&(e.innerHTML='\n    <div class="no-results">\n      <div class="no-results-icon">üîç</div>\n      <h3>No projects found</h3>\n      <p>Try adjusting your search criteria or browse all projects</p>\n      <div class="no-results-actions">\n        <button class="btn btn-primary" onclick="clearAllFilters()">Clear Filters</button>\n        <a href="/projects" class="btn btn-outline">View All Projects</a>\n      </div>\n    </div>\n  ')}function showLoadingState(){const e=document.querySelector(".projects-container");e&&(e.innerHTML='\n    <div class="loading-state">\n      <div class="spinner"></div>\n      <p>Loading projects...</p>\n    </div>\n  ')}function hideLoadingState(){}function showErrorMessage(e){const t=document.querySelector(".projects-container");t&&(t.innerHTML=`\n    <div class="error-state">\n      <div class="error-icon">‚ö†Ô∏è</div>\n      <h3>Error</h3>\n      <p>${e}</p>\n      <button class="btn btn-primary" onclick="location.reload()">Try Again</button>\n    </div>\n  `)}function debounce(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...o)},t)}}function bindEuroFilter(e,t){const n=document.getElementById(e),o=document.getElementById(t);if(!n||!o)return;const i=new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:2}),r=e=>{if("string"!=typeof e)return null;const t=e.replace(/[^0-9,\.]/g,"").replace(/,/g,".");if(!t)return null;const n=Number(t);return Number.isNaN(n)?null:n};if(o.value){const e=Number(o.value);Number.isNaN(e)||(n.value=i.format(e))}n.addEventListener("input",()=>{const e=r(n.value);o.value=null===e?"":String(e.toFixed(2))}),n.addEventListener("blur",()=>{const e=r(n.value);if(null===e)return n.value="",void(o.value="");n.value=i.format(e),o.value=String(e.toFixed(2))})}document.addEventListener("DOMContentLoaded",function(){initializeProjectList();try{const e=document.getElementById("filterCountry"),t=document.getElementById("filterCity");e&&t&&"function"==typeof window.updateCities&&(window.updateCities(!0),"function"==typeof window.updateNeighborhoods&&window.updateNeighborhoods(!0))}catch(e){}}),"function"!=typeof window.updateSort&&(window.updateSort=function(){const e=document.getElementById("sortBy")||document.getElementById("sort");if(!e)return;const t=new URL(window.location);t.searchParams.set("sort",e.value),t.searchParams.delete("page"),window.location.href=t.toString()}),window.openUnitTypes=openUnitTypes,window.ProjectList={clearAllFilters:clearAllFilters,applyFilters:applyFilters,goToPage:goToPage},function(){function e(){return{country:document.getElementById("filterCountry"),city:document.getElementById("filterCity"),neighborhood:document.getElementById("filterNeighborhood")}}function t(e,t,n){if(!e)return;const o=e.value;e.innerHTML="";const i=document.createElement("option");i.value="",i.textContent=n,e.appendChild(i),t.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)}),o&&t.includes(o)?e.value=o:e.value=""}window.updateCities=function(){const{country:n,city:o,neighborhood:i}=e();if(!n||!o||!i)return;const r=getLocationsData()||{},a=n.value,s=a&&r[a]?Object.keys(r[a]):[];t(o,s,"Any City"),t(i,[],"Any Neighborhood"),o.disabled=0===s.length,i.disabled=!0},window.updateNeighborhoods=function(){const{country:n,city:o,neighborhood:i}=e();if(!n||!o||!i)return;const r=getLocationsData()||{},a=n.value,s=o.value,c=a&&s&&r[a]&&r[a][s]?r[a][s]:[];t(i,c,"Any Neighborhood"),i.disabled=0===c.length}}();