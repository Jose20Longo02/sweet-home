let I18N={};function loadI18n(){try{const e=document.getElementById("i18n-property-list");if(!e)return;const t=e.getAttribute("data-i18n")||"{}";I18N=JSON.parse(t)}catch(e){}}function i18nGet(e,t){try{return e.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,I18N)??t}catch(e){return t}}let map=null,markers=[],propertiesData=[],LOCATIONS={},LOCATION_COLORS={};function applyLocationColors(){try{document.querySelectorAll(".property-card").forEach(e=>{const t=(e.dataset.country||"").trim(),o=LOCATION_COLORS&&LOCATION_COLORS[t];o&&e.style.setProperty("--country-color",o)})}catch(e){}}function initializeCollapsibles(){try{document.querySelectorAll(".filter-group.collapsible > h4").forEach(e=>{e.addEventListener("click",()=>{const t=e.parentElement;t&&t.classList.contains("collapsible")&&t.classList.toggle("collapsed")})})}catch(e){}}function toggleMobileFilters(e){const t=document.getElementById("filtersSidebar"),o=document.getElementById("filtersOverlay");t&&(e?(t.classList.add("open"),t.setAttribute("aria-hidden","false"),o&&o.classList.add("open"),document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden"):(t.classList.remove("open"),t.setAttribute("aria-hidden","true"),o&&o.classList.remove("open"),document.documentElement.style.overflow="",document.body.style.overflow=""))}function updateCities(){const e=document.getElementById("filterCountry"),t=document.getElementById("filterCity"),o=document.getElementById("filterNeighborhood");if(!e||!t)return void console.warn("‚ùå Country or city select elements not found");const n=e.value;if(console.log("üåç Updating cities for country:",n),t.innerHTML=`<option value="">${i18nGet("forms.anyCity","Any City")}</option>`,o&&(o.innerHTML=`<option value="">${i18nGet("forms.anyNeighborhood","Any Neighborhood")}</option>`,o.disabled=!0),n&&LOCATIONS[n]){const e=Object.keys(LOCATIONS[n]);console.log("üèôÔ∏è Found cities:",e),e.forEach(e=>{const o=document.createElement("option");o.value=e,o.textContent=e,t.appendChild(o)}),t.disabled=!1,console.log(`‚úÖ Populated ${e.length} cities, city dropdown enabled`)}else t.disabled=!0,console.log("‚ùå No cities found for country:",n)}function updateNeighborhoods(){const e=document.getElementById("filterCountry"),t=document.getElementById("filterCity"),o=document.getElementById("filterNeighborhood");if(!e||!t||!o)return void console.warn("‚ùå One or more select elements not found for neighborhood update");const n=e.value,a=t.value;if(console.log("üèôÔ∏è Updating neighborhoods for city:",a,"in country:",n),o.innerHTML='<option value="">Any Neighborhood</option>',n&&a&&LOCATIONS[n]&&LOCATIONS[n][a]){const e=LOCATIONS[n][a];console.log("üèòÔ∏è Found neighborhoods:",e),e.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,o.appendChild(t)}),o.disabled=!1,console.log(`‚úÖ Populated ${e.length} neighborhoods, neighborhood dropdown enabled`)}else o.disabled=!0,console.log("‚ùå No neighborhoods found for city:",a)}function clearAllFilters(){window.location.href="/properties"}function removeFilter(e,t=null){const o=new URL(window.location);switch(e){case"country":o.searchParams.delete("country"),o.searchParams.delete("city"),o.searchParams.delete("neighborhood");break;case"city":o.searchParams.delete("city"),o.searchParams.delete("neighborhood");break;case"type":if(t){const e=o.searchParams.getAll("type").filter(e=>e!==t);o.searchParams.delete("type"),e.forEach(e=>o.searchParams.append("type",e))}else o.searchParams.delete("type");break;case"price":o.searchParams.delete("min_price"),o.searchParams.delete("max_price");break;case"size":o.searchParams.delete("min_size"),o.searchParams.delete("max_size");break;case"year_built":o.searchParams.delete("year_built_min"),o.searchParams.delete("year_built_max");break;case"rooms":o.searchParams.delete("rooms");break;case"bathrooms":o.searchParams.delete("bathrooms");break;case"features":if(t){const e=o.searchParams.getAll("features").filter(e=>e!==t);o.searchParams.delete("features"),e.forEach(e=>o.searchParams.append("features",e))}else o.searchParams.delete("features");break;case"status":if(t){const e=o.searchParams.getAll("status").filter(e=>e!==t);o.searchParams.delete("status"),e.forEach(e=>o.searchParams.append("status",e))}else o.searchParams.delete("status");break;case"featured":o.searchParams.delete("featured");break;case"new_listing":o.searchParams.delete("new_listing")}o.searchParams.delete("page"),window.location.href=o.toString()}function handleCheckboxChange(e,t,o){const n=new URL(window.location);if(o)n.searchParams.append(e,t);else{const o=n.searchParams.getAll(e).filter(e=>e!==t);n.searchParams.delete(e),o.forEach(t=>n.searchParams.append(e,t))}n.searchParams.delete("page"),window.location.href=n.toString()}function initializeMap(){const e=document.getElementById("propertyMap");if(e&&!map)try{const t=window.propertiesData||[];let o=40.4168,n=-3.7038;if(t.length>0){const e=t[0];e.latitude&&e.longitude&&(o=parseFloat(e.latitude),n=parseFloat(e.longitude))}map=L.map("propertyMap").setView([o,n],10),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors"}).addTo(map),addPropertyMarkers(t);const a=e.querySelector(".map-loading");a&&(a.style.display="none")}catch(t){console.error("Error initializing map:",t);const o=i18nGet("map.error","Unable to load map. Please try refreshing the page."),n=i18nGet("common.retry","Retry");e.innerHTML=`\n      <div class="map-error">\n        <p>${o}</p>\n        <button onclick="initializeMap()" class="btn btn-secondary">${n}</button>\n      </div>\n    `}}function addPropertyMarkers(e){if(!map||!e)return;markers.forEach(e=>map.removeLayer(e)),markers=[];const t=[];if(e.forEach(e=>{let o,n;if(!e.latitude||!e.longitude)return void t.push(e);o=parseFloat(e.latitude),n=parseFloat(e.longitude);const a=L.divIcon({className:"custom-marker",html:`\n        <div class="marker-content">\n          <div class="marker-price">‚Ç¨${formatPrice(e.price)}</div>\n          <div class="marker-type">${e.type}</div>\n        </div>\n      `,iconSize:[80,40],iconAnchor:[40,20]}),r=L.marker([o,n],{icon:a}).addTo(map).bindPopup(createMarkerPopup(e));markers.push(r)}),t.length>0&&geocodeProperties(t),markers.length>0){const e=new L.featureGroup(markers);map.fitBounds(e.getBounds().pad(.1))}}async function geocodeProperties(e){for(const t of e)try{const e=encodeURIComponent(`${t.city}, ${t.country}`),o=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${e}&limit=1`);if(o.ok){const e=await o.json();if(e.length>0){const o=parseFloat(e[0].lat),n=parseFloat(e[0].lon),a=L.divIcon({className:"custom-marker geocoded",html:`\n              <div class="marker-content">\n                <div class="marker-price">‚Ç¨${formatPrice(t.price)}</div>\n                <div class="marker-type">${t.type}</div>\n              </div>\n            `,iconSize:[80,40],iconAnchor:[40,20]}),r=L.marker([o,n],{icon:a}).addTo(map).bindPopup(createMarkerPopup(t));if(markers.push(r),markers.length>0){const e=new L.featureGroup(markers);map.fitBounds(e.getBounds().pad(.1))}}}}catch(e){console.warn(`Could not geocode ${t.city}, ${t.country}:`,e)}}function createMarkerPopup(e){const t=i18nGet("meta.beds","beds"),o=i18nGet("meta.baths","baths"),n=i18nGet("meta.sqm","m¬≤"),a=i18nGet("viewDetails","View details");return`\n    <div class="marker-popup">\n      <img src="${e.photos&&e.photos[0]?e.photos[0]:"/img/property-placeholder.jpg"}" \n           alt="${e.title}" class="popup-image" loading="lazy" decoding="async">\n      <div class="popup-content">\n        <h4>${e.title}</h4>\n        <p class="popup-location">${e.city}, ${e.country}</p>\n        <p class="popup-price">‚Ç¨${formatPrice(e.price)}</p>\n        <div class="popup-details">\n          <span>${e.rooms||0} ${t}</span>\n          <span>${e.bathrooms||0} ${o}</span>\n          <span>${e.size||0} ${n}</span>\n        </div>\n        <a href="/properties/${e.slug}" class="popup-link">${a}</a>\n      </div>\n    </div>\n  `}function formatPrice(e){return e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"}function updateSort(){const e=document.getElementById("sortBy");if(!e)return;const t=new URL(window.location);t.searchParams.set("sort",e.value),t.searchParams.delete("page"),window.location.href=t.toString()}window.updateSort=updateSort;let comparisonList=[];function compareProperty(e){const t=document.querySelector(`[data-property-id="${e}"]`);if(!t)return;let o=!1;const n=t.querySelector(".property-title"),a=t.querySelector(".property-location"),r=t.querySelector(".price-amount"),i=t.querySelectorAll(".property-meta .meta-item span"),s=t.querySelector(".property-image img"),c=t.getAttribute("data-type")||"",l=t.getAttribute("data-size")||"",d=t.getAttribute("data-rooms")||"",m=t.getAttribute("data-bathrooms")||"",p=t.getAttribute("data-country")||"",u=t.getAttribute("data-city")||"",h=t.getAttribute("data-neighborhood")||"",g=i&&i[0]?i[0].textContent:"",f=i&&i[1]?i[1].textContent:"",y=i&&i[2]?i[2].textContent:"",v=a?a.textContent.trim():"",b=h&&u?`${h}, ${u}`:u&&p?`${u}, ${p}`:v,S={id:e,title:n?n.textContent:"",location:b,price:r?r.textContent:"",type:c,rooms:d||f,bathrooms:m||y,size:l||g,image:s?s.src:"",priceNum:(()=>{const e=t.getAttribute("data-price"),o=e?parseFloat(e):NaN;return Number.isFinite(o)?o:NaN})(),sizeNum:(()=>{if(l){const e=parseFloat(l);return Number.isFinite(e)?e:NaN}const e=g?String(g):"",t=parseFloat(e.replace(/[^0-9.]/g,""));return Number.isFinite(t)?t:NaN})()},L=comparisonList.findIndex(t=>t.id===e);if(-1!==L)comparisonList.splice(L,1),t.classList.remove("in-comparison"),showNotification(i18nGet("compare.removed","Property removed from comparison"),"info");else{if(comparisonList.length>=3)return void showNotification(i18nGet("compare.max","You can only compare up to 3 properties at a time"),"warning");comparisonList.push(S),t.classList.add("in-comparison"),showNotification(i18nGet("compare.added","Property added to comparison"),"success"),o=!0}if(updateComparisonUI(),o&&comparisonList.length>0){const e=document.getElementById("comparisonContainer");e&&requestAnimationFrame(()=>{const t=e.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,n=t.top+o-160;window.scrollTo({top:Math.max(0,n),behavior:"smooth"})})}}function updateComparisonUI(){const e=document.getElementById("comparisonContainer");if(!e)return;if(0===comparisonList.length)return void(e.style.display="none");e.style.display="block";document.getElementById("comparisonList").innerHTML=comparisonList.map(e=>`\n    <div class="comparison-item">\n      <img src="${e.image}" alt="${e.title}" class="comparison-image">\n      <div class="comparison-details">\n        <h4>${e.title}</h4>\n        <p>${e.location}</p>\n        <p class="comparison-price">${e.price}</p>\n      </div>\n      <button class="comparison-remove" data-id="${e.id}" aria-label="${(i18nGet("compare.removeAria","Remove %s from comparison")||"").replace("%s",e.title)}" title="${i18nGet("compare.remove","Remove from comparison")}">&times;</button>\n    </div>\n  `).join("");const t=document.getElementById("compareBtn");if(t){const e=i18nGet("compare.cta","Compare");t.textContent=`${e} (${comparisonList.length})`,t.disabled=!1}}function clearComparison(){comparisonList.forEach(e=>{const t=document.querySelector(`[data-property-id="${e.id}"]`);t&&t.classList.remove("in-comparison")}),comparisonList=[];const e=document.getElementById("comparisonContainer"),t=document.getElementById("comparisonList"),o=document.getElementById("compareBtn");if(t&&(t.innerHTML=""),e&&(e.style.display="none"),o){const e=i18nGet("compare.cta","Compare");o.textContent=`${e} (0)`,o.disabled=!0}showNotification(i18nGet("compare.cleared","Comparison cleared"),"info")}function showComparisonModal(){if(comparisonList.length<2)return void showNotification(i18nGet("compare.needTwo","Please select at least 2 properties to compare"),"warning");const e=document.getElementById("comparisonModal"),t=document.getElementById("comparisonContent");if(!e||!t)return;const o=createComparisonTable();t.innerHTML=o,e.style.display="block"}function createComparisonTable(){const e=[i18nGet("compare.headers.feature","Feature"),...comparisonList.map(e=>e.title)],t=[[i18nGet("compare.headers.image","Image"),...comparisonList.map(e=>`<img src="${e.image}" alt="${e.title}" class="comparison-modal-image">`)],[i18nGet("compare.headers.location","Location"),...comparisonList.map(e=>e.location)],[i18nGet("compare.headers.price","Price"),...comparisonList.map(e=>e.price)],[i18nGet("compare.headers.pricePerSqm","Price per m¬≤"),...comparisonList.map(e=>formatPricePerSqm(e.priceNum,e.sizeNum))],[i18nGet("compare.headers.type","Type"),...comparisonList.map(e=>e.type)],[i18nGet("compare.headers.rooms","Rooms"),...comparisonList.map(e=>e.rooms)],[i18nGet("compare.headers.bathrooms","Bathrooms"),...comparisonList.map(e=>e.bathrooms)],[i18nGet("compare.headers.size","Size"),...comparisonList.map(e=>e.size)]];let o=`\n    <div class="comparison-table-container">\n      <table class="comparison-table">\n        <thead>\n          <tr>\n            ${e.map(e=>`<th>${e}</th>`).join("")}\n          </tr>\n        </thead>\n        <tbody>\n  `;return t.forEach(e=>{o+="<tr>",e.forEach((e,t)=>{o+=0===t?`<td class="feature-label">${e}</td>`:`<td>${e}</td>`}),o+="</tr>"}),o+="\n        </tbody>\n      </table>\n    </div>\n  ",o}function formatPricePerSqm(e,t){try{if(!Number.isFinite(e)||!Number.isFinite(t)||t<=0)return"‚Äî";return`‚Ç¨${Math.round(e/t).toLocaleString("en-US")} / m¬≤`}catch(e){return"‚Äî"}}function closeComparisonModal(){const e=document.getElementById("comparisonModal");e&&(e.style.display="none")}function removeFromComparison(e){const t=comparisonList.findIndex(t=>t.id===e);if(-1===t)return;const o=document.querySelector(`[data-property-id="${e}"]`);o&&o.classList.remove("in-comparison"),comparisonList.splice(t,1),updateComparisonUI(),showNotification(i18nGet("compare.removed","Property removed from comparison"),"info")}function showNotification(e,t="info"){const o=document.createElement("div");o.className=`notification notification-${t}`,o.innerHTML=`\n    <span class="notification-message">${e}</span>\n    <button class="notification-close" onclick="this.parentElement.remove()">&times;</button>\n  `,document.body.appendChild(o),setTimeout(()=>{o.parentElement&&o.remove()},3e3)}let savedSearches=[];function saveSearch(){const e=document.getElementById("saveSearchModal");if(!e)return;const t=document.getElementById("searchName");if(t){const e=generateSearchName(getCurrentFilters());t.value=e}e.style.display="block"}function closeSaveSearchModal(){const e=document.getElementById("saveSearchModal");e&&(e.style.display="none")}function closeSavedSearchesModal(){const e=document.getElementById("savedSearchesModal");e&&(e.style.display="none")}function getCurrentFilters(){const e=new URLSearchParams(window.location.search),t={};for(let[o,n]of e.entries())"page"!==o&&(t[o]?Array.isArray(t[o])?t[o].push(n):t[o]=[t[o],n]:t[o]=n);return t}function generateSearchName(e){const t=[];if(e.country&&t.push(e.country),e.city&&t.push(e.city),e.type&&e.type.length>0&&(1===e.type.length?t.push(e.type[0]):t.push(`${e.type.length} types`)),e.rooms&&e.rooms.length>0){const o=Math.max(...e.rooms.map(e=>parseInt(e)));t.push(`${o}+ room`)}return(e.min_price||e.max_price)&&(e.min_price&&e.max_price?t.push(`‚Ç¨${e.min_price}-${e.max_price}`):e.min_price?t.push(`‚Ç¨${e.min_price}+`):e.max_price&&t.push(`‚Ç¨${e.max_price}-`)),t.length>0?t.join(" "):"Custom Search"}function saveSearchToStorage(e,t,o){const n=getCurrentFilters(),a={id:Date.now(),name:e,description:t,filters:n,emailAlerts:o,createdAt:(new Date).toISOString(),lastUsed:(new Date).toISOString()},r=localStorage.getItem("savedSearches");savedSearches=r?JSON.parse(r):[],savedSearches.push(a),localStorage.setItem("savedSearches",savedSearches),showNotification(i18nGet("saved.savedOk","Search saved successfully!"),"success"),closeSaveSearchModal()}function loadSavedSearches(){const e=localStorage.getItem("savedSearches");return savedSearches=e?JSON.parse(e):[],savedSearches}function applySavedSearch(e){const t=savedSearches.find(t=>t.id===e);if(!t)return;t.lastUsed=(new Date).toISOString(),localStorage.setItem("savedSearches",JSON.stringify(savedSearches));const o=new URL("/properties",window.location.origin);Object.entries(t.filters).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>o.searchParams.append(e,t)):o.searchParams.set(e,t)}),window.location.href=o.toString()}function deleteSavedSearch(e){savedSearches=savedSearches.filter(t=>t.id!==e),localStorage.setItem("savedSearches",JSON.stringify(savedSearches)),showSavedSearchesModal(),showNotification(i18nGet("saved.deletedOk","Search deleted successfully!"),"info")}function showSavedSearchesModal(){const e=document.getElementById("savedSearchesModal"),t=document.getElementById("savedSearchesContent");if(!e||!t)return;const o=loadSavedSearches();0===o.length?t.innerHTML=`\n      <div class="no-saved-searches">\n        <div class="no-saved-searches-icon">üîç</div>\n        <h4>${i18nGet("saved.noneTitle","No Saved Searches")}</h4>\n        <p>${i18nGet("saved.noneHint","Save your property searches to quickly access them later.")}</p>\n      </div>\n    `:t.innerHTML=o.map(e=>`\n      <div class="saved-search-item">\n        <div class="saved-search-info">\n          <h4>${e.name}</h4>\n          <p>${e.description||i18nGet("saved.noDescription","No description")}</p>\n          <div class="saved-search-meta">\n            <span>${i18nGet("saved.created","Created:")} ${new Date(e.createdAt).toLocaleDateString()}</span>\n            <span>${i18nGet("saved.lastUsed","Last used:")} ${new Date(e.lastUsed).toLocaleDateString()}</span>\n            ${e.emailAlerts?`<span class="email-alert-badge">${i18nGet("saved.emailAlerts","Email Alerts")}</span>`:""}\n          </div>\n        </div>\n        <div class="saved-search-actions">\n          <button class="btn btn-primary btn-sm" onclick="applySavedSearch(${e.id})">${i18nGet("saved.apply","Apply Search")}</button>\n          <button class="btn btn-outline btn-sm" onclick="deleteSavedSearch(${e.id})">${i18nGet("saved.delete","Delete")}</button>\n        </div>\n      </div>\n    `).join(""),e.style.display="block"}function updateFilters(){const e=document.getElementById("filtersForm");if(!e)return;normalizePriceHiddenInputs();const t=new FormData(e),o=new URL(window.location);["country","city","neighborhood","type","min_price","max_price","rooms","bathrooms","featured","new_listing","min_size","max_size","year_built_min","year_built_max","features","status"].forEach(e=>o.searchParams.delete(e));for(let[e,n]of t.entries())n&&""!==n.trim()&&("type"===e||"rooms"===e||"features"===e||"status"===e?o.searchParams.append(e,n):o.searchParams.set(e,n));o.searchParams.delete("page"),window.location.href=o.toString()}function updateConditionalFilterVisibility(){const e=document.querySelectorAll('input[name="type"]'),t=new URLSearchParams(window.location.search).getAll("type").map(e=>String(e).toLowerCase()),o=t.length>0&&t.every(e=>"land"===e),n=Array.from(e),a=n.some(e=>e.checked)&&n.every(e=>!e.checked||"land"===e.value.toLowerCase())||o;['[data-filter-group="rooms"]','[data-filter-group="bathrooms"]','[data-filter-group="year_built"]','[data-filter-group="features"]'].forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.style.display=a?"none":""})}),e.forEach(e=>{e.addEventListener("change",()=>{updateConditionalFilterVisibility()})})}function normalizePriceHiddenInputs(){const e=document.getElementById("minPrice"),t=document.getElementById("maxPrice"),o=document.getElementById("minPriceHidden"),n=document.getElementById("maxPriceHidden");if(e&&o){const t=parseEuroToNumber(e.value);o.value=Number.isFinite(t)?t:""}if(t&&n){const e=parseEuroToNumber(t.value);n.value=Number.isFinite(e)?e:""}}function initializeEuroPriceInputs(){const e=document.getElementById("minPrice"),t=document.getElementById("maxPrice");[{text:e,hidden:document.getElementById("minPriceHidden")},{text:t,hidden:document.getElementById("maxPriceHidden")}].forEach(e=>{if(e.text&&e.hidden){if(e.hidden.value){const t=parseFloat(e.hidden.value);e.text.value=isFinite(t)&&t>=0?formatEuro(t):""}e.text.addEventListener("input",()=>{const t=e.text.value.replace(/\D+/g,"");if(0===t.length)return e.text.value="",void(e.hidden.value="");const o=parseInt(t,10);e.hidden.value=Number.isFinite(o)?String(o):""}),e.text.addEventListener("blur",()=>{const t=parseEuroToNumber(e.text.value);e.text.value=Number.isFinite(t)?formatEuro(t):"",e.hidden.value=Number.isFinite(t)?String(t):""})}})}function parseEuroToNumber(e){if(!e)return NaN;const t=String(e).replace(/[^0-9]/g,"");return t?parseInt(t,10):NaN}function formatEuro(e){try{return`‚Ç¨${Number(e).toLocaleString("en-US")}`}catch(t){return`‚Ç¨${e}`}}function initializeFilterState(){console.log("üîç Initializing filter state from URL parameters...");const e=new URLSearchParams(window.location.search),t=e.get("country");if(t){console.log("üåç Setting country from URL:",t);const o=document.getElementById("filterCountry");if(o){o.value=t,console.log("‚úÖ Country set, updating cities..."),updateCities();const n=e.get("city");n&&(console.log("üèôÔ∏è Setting city from URL:",n),setTimeout(()=>{const t=document.getElementById("filterCity");if(t){t.value=n,console.log("‚úÖ City set, updating neighborhoods..."),updateNeighborhoods();const o=e.get("neighborhood");o&&(console.log("üèòÔ∏è Setting neighborhood from URL:",o),setTimeout(()=>{const e=document.getElementById("filterNeighborhood");e?(e.value=o,console.log("‚úÖ Neighborhood set successfully")):console.warn("‚ùå Neighborhood select element not found")},150))}else console.warn("‚ùå City select element not found")},100))}else console.warn("‚ùå Country select element not found")}const o=e.get("year_built_min"),n=e.get("year_built_max");if(o){const e=document.getElementById("yearBuiltMin");e&&(e.value=o)}if(n){const e=document.getElementById("yearBuiltMax");e&&(e.value=n)}console.log("‚úÖ Filter state initialization complete")}document.addEventListener("DOMContentLoaded",function(){console.log("üöÄ Property list page initializing..."),loadI18n();const e=document.getElementById("clearAllFiltersBtn");e&&e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),console.log("üîÑ Clear All Filters clicked"),clearAllFilters()});document.querySelectorAll(".clear-all-filters-btn").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),console.log("üîÑ Clear All Filters clicked"),clearAllFilters()})});const t=document.getElementById("locations-data");if(t)try{const e=t.getAttribute("data-locations")||"{}";LOCATIONS=JSON.parse(e),console.log("‚úÖ Locations data loaded successfully:",LOCATIONS),console.log("üìä Available countries:",Object.keys(LOCATIONS))}catch(e){console.error("‚ùå Could not parse locations data:",e),console.error("Raw data:",t.getAttribute("data-locations")),LOCATIONS={}}else console.warn("‚ùå Locations data element not found"),LOCATIONS={};const o=document.getElementById("location-colors-data");if(o)try{const e=o.getAttribute("data-location-colors")||"{}";LOCATION_COLORS=JSON.parse(e),console.log("üé® Location colors loaded:",LOCATION_COLORS)}catch(e){console.error("‚ùå Could not parse location colors:",e),LOCATION_COLORS={}}LOCATIONS&&"object"==typeof LOCATIONS&&0!==Object.keys(LOCATIONS).length?console.log("‚úÖ Locations data validated successfully"):console.error("‚ùå Invalid or empty locations data:",LOCATIONS),console.log("üîç Initializing cities dropdown..."),updateCities();const n=document.getElementById("filterCountry"),a=document.getElementById("filterCity");n&&n.addEventListener("change",function(){updateCities()}),a&&a.addEventListener("change",function(){updateNeighborhoods()});const r=document.getElementById("filtersForm");r&&r.addEventListener("submit",function(e){e.preventDefault(),updateFilters()}),updateConditionalFilterVisibility();const i=document.getElementById("sortBy");i&&i.addEventListener("change",function(){updateSort()});const s=document.getElementById("saveSearchForm");s&&s.addEventListener("submit",function(e){e.preventDefault();const t=new FormData(this),o=t.get("searchName"),n=t.get("searchDescription"),a="on"===t.get("emailAlerts");o.trim()&&saveSearchToStorage(o,n,a)}),initializeFilterState(),loadSavedSearches(),initializeEuroPriceInputs(),applyLocationColors(),initializeCollapsibles(),document.addEventListener("click",e=>{const t=document.getElementById("filtersSidebar");if(t&&t.classList.contains("open")){t.contains(e.target)||e.target.closest(".mobile-filters-trigger")||toggleMobileFilters(!1)}});const c=document.getElementById("propertiesGrid");c&&c.addEventListener("click",e=>{if(e.target.closest(".btn-compare")){const t=e.target.closest(".property-card");if(t){const e=t.getAttribute("data-property-id");e&&compareProperty(e)}return}if(e.target.closest(".btn-view")){const t=e.target.closest(".property-card"),o=t&&t.getAttribute("data-slug");return void(o&&(window.location.href=`/properties/${o}`))}const t=e.target.closest(".property-card");if(t){const e=t.getAttribute("data-slug");e&&(window.location.href=`/properties/${e}`)}});const l=document.getElementById("compareBtn");l&&l.addEventListener("click",()=>{showComparisonModal()});const d=document.getElementById("comparisonList");d&&d.addEventListener("click",e=>{const t=e.target.closest(".comparison-remove");if(!t)return;const o=t.getAttribute("data-id");o&&removeFromComparison(o)});const m=document.getElementById("clearComparisonBtn");m&&m.addEventListener("click",()=>{clearComparison()});const p=document.getElementById("comparisonModalClose");p&&p.addEventListener("click",()=>{closeComparisonModal()});const u=document.querySelector(".mobile-filters-trigger");u&&u.addEventListener("click",e=>{e.preventDefault(),toggleMobileFilters(!0)});const h=document.querySelector(".filters-close");h&&h.addEventListener("click",e=>{e.preventDefault(),toggleMobileFilters(!1)});const g=document.getElementById("filtersOverlay");g&&g.addEventListener("click",()=>toggleMobileFilters(!1))});