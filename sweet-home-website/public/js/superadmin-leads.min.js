function getCsrfToken(){var e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):""}function ensureModal(){var e=document.getElementById("confirm-modal");if(e)return e;var t=document.createElement("div");return t.className="modal-overlay",t.id="confirm-modal",t.innerHTML='\n    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="confirm-title">\n      <header id="confirm-title">Confirm deletion</header>\n      <div class="modal-body">Are you sure you want to delete this lead? This action cannot be undone.</div>\n      <div class="modal-actions">\n        <button class="btn btn-light" data-modal-cancel>Cancel</button>\n        <button class="btn btn-danger" data-modal-confirm>Delete</button>\n      </div>\n    </div>\n  ',document.body.appendChild(t),t}function openConfirm(){var e=ensureModal();return e.classList.add("open"),e.style.display="flex",new Promise(function(t){function n(){o(),t(!1)}function a(){o(),t(!0)}function o(){e.classList.remove("open"),e.style.display="none",e.removeEventListener("click",s),d.removeEventListener("click",n),l.removeEventListener("click",a)}function s(t){t.target===e&&n()}var d=e.querySelector("[data-modal-cancel]"),l=e.querySelector("[data-modal-confirm]");e.addEventListener("click",s),d.addEventListener("click",n),l.addEventListener("click",a)})}function showMessageModal(e){const t=document.getElementById("messageModal"),n=document.getElementById("messageContent");t&&n&&(n.textContent=decodeURIComponent(e),t.style.display="flex",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.width="100vw",t.style.height="100vh",t.style.zIndex="9999",t.style.background="rgba(0,0,0,0.45)",t.style.alignItems="center",t.style.justifyContent="center",t.style.margin="0",t.style.padding="20px",t.style.boxSizing="border-box")}function hideMessageModal(){const e=document.getElementById("messageModal");e&&(e.style.display="none",e.style.position="",e.style.top="",e.style.left="",e.style.right="",e.style.bottom="",e.style.width="",e.style.height="",e.style.zIndex="",e.style.background="",e.style.alignItems="",e.style.justifyContent="",e.style.margin="",e.style.padding="",e.style.boxSizing="")}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("messageModal"),t=document.getElementById("messageModalClose");t&&t.addEventListener("click",hideMessageModal),e&&e.addEventListener("click",function(t){t.target===e&&hideMessageModal()})}),document.addEventListener("click",function(e){if(e.target.getAttribute("data-show-message")){const t=e.target.getAttribute("data-message");t&&showMessageModal(t)}const t=e.target.getAttribute("data-toggle-notes");if(t){const e=document.getElementById("notes-"+t);e&&(e.style.display="none"===e.style.display?"":"none")}var n=e.target.closest("[data-save]");const a=n&&n.getAttribute("data-save");if(a){const e=document.querySelector('.lead-new-note[data-lead-id="'+a+'"]'),t=e&&e.value||"",n=document.querySelector('.lead-last-contact[data-lead-id="'+a+'"]').value,o=document.querySelector('.lead-status[data-lead-id="'+a+'"]').value;fetch("/api/leads/"+a,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":getCsrfToken()},body:JSON.stringify({append_note:t,last_contact_at:n,status:o})}).then(e=>e.json()).then(()=>{var n=document.getElementById("notes-"+a);n&&(n.style.display="none");var o=document.querySelector('[data-notes-list-for="'+a+'"]'),s=document.querySelector('[data-notes-count-for="'+a+'"]');if(o&&t.trim()){var d=(new Date).toISOString().replace("T"," ").slice(0,19),l=document.createElement("li");if(l.style.marginBottom="6px",l.innerHTML="<div>"+t.replace(/</g,"&lt;").replace(/>/g,"&gt;")+'</div><div style="font-size:12px;color:var(--gray-600);">by You â€¢ '+d+"</div>",o.appendChild(l),s){var i=parseInt(s.textContent||"0",10)||0;s.textContent=String(i+1)}}e&&(e.value="")}).catch(()=>{})}var o=e.target.closest("[data-delete-lead]");const s=o&&o.getAttribute("data-delete-lead");s&&openConfirm().then(function(e){e&&fetch("/api/leads/"+s,{method:"DELETE",headers:{"X-CSRF-Token":getCsrfToken()}}).then(e=>e.json()).then(e=>{if(e&&e.success){const e=o.closest("tr"),t=document.getElementById("notes-"+s);t&&t.remove(),e&&e.remove()}else alert("Failed to delete")}).catch(()=>alert("Failed to delete"))})}),document.addEventListener("change",function(e){if(e.target.matches(".lead-status")){const t=e.target.getAttribute("data-lead-id");fetch("/api/leads/"+t,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":getCsrfToken()},body:JSON.stringify({status:e.target.value})})}if(e.target.matches(".lead-last-contact")){const t=e.target.getAttribute("data-lead-id");fetch("/api/leads/"+t,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":getCsrfToken()},body:JSON.stringify({last_contact_at:e.target.value})})}if(e.target.matches(".lead-agent")){const t=e.target.getAttribute("data-lead-id"),n=e.target.value;fetch("/api/leads/"+t,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":getCsrfToken()},body:JSON.stringify({agent_id:n})}).then(function(e){if(!e.ok)throw new Error("Failed to assign");return e.json()}).catch(function(){alert("Failed to assign")})}}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("pageSizeSelect");e&&e.addEventListener("change",function(){const e=this.value,t=new URL(window.location.href);t.searchParams.set("pageSize",e),t.searchParams.set("page","1"),window.location.href=t.toString()})});