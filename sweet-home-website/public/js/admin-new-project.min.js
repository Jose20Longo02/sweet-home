document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("proj-data");let t={};try{t=JSON.parse(e.getAttribute("data-locations")||"{}")}catch(v){t={}}const n=e.getAttribute("data-default-city")||"",o=e.getAttribute("data-default-hood")||"",l=document.getElementById("country"),i=document.getElementById("city"),a=document.getElementById("neighborhood");function d(){const e=Object.keys(t[l.value]||{});i.innerHTML='<option value="">Select city</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n===e&&(t.selected=!0),i.appendChild(t)}),i.disabled=0===e.length,r()}function r(){const e=(t[l.value]||{})[i.value]||[];a.innerHTML='<option value="">Select neighborhood (optional)</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,o===e&&(t.selected=!0),a.appendChild(t)}),a.disabled=0===e.length}function c(e,t){const n=document.getElementById(e),o=document.getElementById(t),l=new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:2}),i=e=>{if("string"!=typeof e)return null;const t=e.replace(/[^0-9,\.]/g,"").replace(/,/g,".");if(!t)return null;const n=Number(t);return Number.isNaN(n)?null:n};if(o&&o.value){const e=Number(o.value);Number.isNaN(e)||(n.value=l.format(e))}n.addEventListener("input",()=>{const e=i(n.value);o.value=null!==e?String(e.toFixed(2)):""}),n.addEventListener("blur",()=>{const e=i(n.value);if(null===e)return n.value="",void(o.value="");n.value=l.format(e),o.value=String(e.toFixed(2))})}l.addEventListener("change",d),i.addEventListener("change",r),d(),c("min_price_display","min_price"),c("max_price_display","max_price");const s=document.getElementById("project_photos"),u=document.getElementById("projPhotoPreview");if(s&&u){let g=null,h=[];function m(){const e=new DataTransfer;h.forEach(t=>e.items.add(t)),s.files=e.files}function p(){u.innerHTML="",h.forEach((e,t)=>{const n=URL.createObjectURL(e),o=document.createElement("div");o.className="item",o.style.position="relative",o.draggable=!0;const l=document.createElement("img");l.src=n,l.className="thumb";const i=document.createElement("button");i.type="button",i.textContent="×",i.setAttribute("aria-label","Remove"),i.style.position="absolute",i.style.right="6px",i.style.top="6px",i.style.width="24px",i.style.height="24px",i.style.borderRadius="50%",i.style.border="none",i.style.background="rgba(0,0,0,0.6)",i.style.color="#fff",i.style.cursor="pointer",i.addEventListener("click",function(){h.splice(t,1),m(),p()});const a=document.createElement("div");a.className="handle",a.textContent="drag",o.appendChild(l),o.appendChild(i),o.appendChild(a),o.addEventListener("dragstart",()=>{g=t}),o.addEventListener("dragover",e=>{e.preventDefault()}),o.addEventListener("drop",e=>{if(e.preventDefault(),null===g)return;const n=h.splice(g,1)[0];h.splice(t,0,n),m(),g=null,p()}),u.appendChild(o)})}s.addEventListener("change",()=>{Array.from(s.files||[]).forEach(e=>{h.some(t=>t.name===e.name&&t.size===e.size&&t.lastModified===e.lastModified)||h.push(e)}),m(),p()})}const y=document.getElementById("project_video"),f=document.getElementById("projVideoPreview");y&&f&&y.addEventListener("change",()=>{if(f.innerHTML="",y.files&&y.files[0]){const e=URL.createObjectURL(y.files[0]),t=document.createElement("div");t.style.position="relative",t.style.display="inline-block";const n=document.createElement("video");n.src=e,n.controls=!0,n.playsInline=!0,n.style.maxWidth="100%";const o=document.createElement("button");o.type="button",o.textContent="×",o.setAttribute("aria-label","Remove video"),o.style.position="absolute",o.style.right="6px",o.style.top="6px",o.style.width="24px",o.style.height="24px",o.style.borderRadius="50%",o.style.border="none",o.style.background="rgba(0,0,0,0.6)",o.style.color="#fff",o.style.cursor="pointer",o.addEventListener("click",function(){y.value="",f.innerHTML=""}),t.appendChild(n),t.appendChild(o),f.appendChild(t)}}),function(){const e=document.getElementById("projectForm");if(!e)return;let t=!1;e.addEventListener("submit",function(){if(t)return!1;if(!e.checkValidity())return!0;t=!0;const n=document.getElementById("uploadOverlay");n&&(n.hidden=!1,n.style.display="flex");const o=e.querySelector('button[type="submit"]');o&&(o.disabled=!0,o.dataset.originalText=o.textContent||"",o.textContent="Uploading...")},{capture:!0})}()});