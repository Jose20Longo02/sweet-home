class PropertyDetailPage{constructor(){this.currentPhotoIndex=0,this.mediaItems=[],this.map=null,this.propertyId=this.getPropertyIdFromUrl(),this.isSubmittingLead=!1,this.youtubePlayer=null,this.youtubeErrorTimeout=null,this.init()}init(){this.loadPhotos(),this.initMap(),this.loadSimilarProperties(),this.bindEvents(),this.incrementView(),this.initDescriptionToggle(),this.initVideoOverlay(),this.relocateContactFormOnMobile(),this.initRecaptcha(),this.initYouTubePlayer()}initYouTubePlayer(){const e=document.getElementById("mainPhoto");if(!e)return;const t=e.getAttribute("data-video-kind"),o=e.getAttribute("data-youtube-id"),n=e.getAttribute("data-video-url");"youtube"===t&&o&&"undefined"!=typeof YT?YT.Player?this.createYouTubePlayer(o,n):window.onYouTubeIframeAPIReady=()=>{this.createYouTubePlayer(o,n)}:"youtube"===t&&o&&this.initYouTubeIframeFallback(e,o,n)}createYouTubePlayer(e,t){const o=document.getElementById("mainPhoto");if(!o)return;const n=o.querySelector("iframe");n&&n.remove();const r=document.getElementById("youtubeErrorFallback");r&&(r.style.display="none");const i=document.querySelector(".video-play-overlay");i&&(i.style.display="none");const a=document.createElement("div");a.id="youtube-player",o.insertBefore(a,o.firstChild);try{this.youtubePlayer=new YT.Player("youtube-player",{videoId:e,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,modestbranding:1,playsinline:1,enablejsapi:1,origin:window.location.origin},events:{onError:e=>{this.handleYouTubeError(e,t)},onReady:()=>{this.youtubeErrorTimeout&&(clearTimeout(this.youtubeErrorTimeout),this.youtubeErrorTimeout=null);const e=document.getElementById("youtube-player");e&&(e.style.width="100%",e.style.height="100%")}}}),this.youtubeErrorTimeout=setTimeout(()=>{this.youtubePlayer&&void 0===this.youtubePlayer.getPlayerState()&&this.handleYouTubeError({data:153},t)},5e3)}catch(e){console.error("Error creating YouTube player:",e),this.handleYouTubeError({data:153},t)}}initYouTubeIframeFallback(e,t,o){const n=`https://www.youtube.com/embed/${t}?enablejsapi=1&rel=0&modestbranding=1&playsinline=1&origin=${encodeURIComponent(window.location.origin)}`,r=e.querySelector("iframe");r&&r.remove();const i=document.getElementById("youtubeErrorFallback");i&&(i.style.display="none");const a=document.querySelector(".video-play-overlay");a&&(a.style.display="none");const l=document.createElement("iframe");l.id="youtube-iframe",l.width="100%",l.height="100%",l.style.border="0",l.style.position="absolute",l.style.top="0",l.style.left="0",l.allow="autoplay; fullscreen; picture-in-picture",l.allowFullscreen=!0,l.src=n,l.onload=()=>{setTimeout(()=>{},3e3)},l.onerror=()=>{this.handleYouTubeError({data:153},o)},e.insertBefore(l,e.firstChild)}handleYouTubeError(e,t){const o=document.getElementById("mainPhoto");if(!o)return;const n=document.getElementById("youtube-player");n&&n.remove();const r=o.querySelector("iframe#youtube-iframe");if(r&&r.remove(),this.youtubePlayer){try{this.youtubePlayer.destroy()}catch(e){}this.youtubePlayer=null}let i=document.getElementById("youtubeErrorFallback");i||(i=document.createElement("div"),i.id="youtubeErrorFallback",i.className="youtube-error-fallback",i.innerHTML=`\n        <div class="youtube-error-content">\n          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <circle cx="12" cy="12" r="10"></circle>\n            <line x1="12" y1="8" x2="12" y2="12"></line>\n            <line x1="12" y1="16" x2="12.01" y2="16"></line>\n          </svg>\n          <h3>Video unavailable</h3>\n          <p>This video cannot be embedded. It may be private, deleted, or embedding may be disabled.</p>\n          <a href="${t}" target="_blank" rel="noopener" class="btn btn-primary">\n            Watch on YouTube\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>\n              <polyline points="15 3 21 3 21 9"></polyline>\n              <line x1="10" y1="14" x2="21" y2="3"></line>\n            </svg>\n          </a>\n        </div>\n      `,o.insertBefore(i,o.firstChild)),i.style.display="flex";const a=document.querySelector(".video-play-overlay");a&&(a.style.display="none")}initVideoOverlay(){const e=document.getElementById("mainVideo"),t=document.querySelector(".video-play-overlay");if(!e||!t)return;const o=()=>{t.style.display=e.paused?"flex":"none"};o(),e.addEventListener("play",o),e.addEventListener("pause",o),e.addEventListener("ended",o)}getPropertyIdFromUrl(){const e=document.getElementById("propertyData"),t=e?e.getAttribute("data-id"):null;if(t)return t;const o=window.location.pathname.split("/");return o[o.length-1]}loadPhotos(){const e=document.querySelectorAll(".gallery-thumbnails .thumbnail");this.mediaItems=Array.from(e).map(e=>{if("video"===(e.getAttribute("data-type")||"image"))return{type:"video",src:e.getAttribute("data-video-url")||"",kind:e.getAttribute("data-video-kind")||"file",embed:e.getAttribute("data-video-embed")||""};const t=e.querySelector("img");return{type:"image",src:t?t.src:""}}),this.mediaItems.length>0&&this.updateMainPhoto(0)}updateMainPhoto(e){const t=document.getElementById("mainPhoto"),o=document.getElementById("mainPhotoImg"),n=document.getElementById("mainVideo"),r=document.querySelectorAll(".gallery-thumbnails .thumbnail");if(!t||0===r.length||0===this.mediaItems.length)return;const i=this.mediaItems[e];if(r.forEach((t,o)=>{t.classList.toggle("active",o===e)}),"video"===i.type){o&&o.remove();const e=document.getElementById("mainPhoto"),r=e?.getAttribute("data-video-kind")||i.kind||"file",a=e?.getAttribute("data-video-embed")||i.embed||"",l=e?.getAttribute("data-youtube-id")||i.youtubeId||"",s=e?.getAttribute("data-video-url")||i.videoUrl||"";if("file"!==r&&a)if("youtube"===r&&l&&"undefined"!=typeof YT&&YT.Player){const e=document.querySelector(".video-play-overlay");if(e&&(e.style.display="none"),this.youtubePlayer){try{this.youtubePlayer.destroy()}catch(e){}this.youtubePlayer=null}const o=t.querySelector("iframe");o&&o.remove();const n=document.getElementById("youtube-player");n&&n.remove();const r=document.getElementById("youtubeErrorFallback");r&&r.remove();const i=document.createElement("div");i.id="youtube-player",t.insertBefore(i,t.firstChild);try{this.youtubePlayer=new YT.Player("youtube-player",{videoId:l,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,modestbranding:1,playsinline:1,enablejsapi:1,origin:window.location.origin},events:{onError:e=>{this.handleYouTubeError(e,s)},onReady:()=>{const e=document.getElementById("youtube-player");e&&(e.style.width="100%",e.style.height="100%")}}})}catch(e){console.error("Error creating YouTube player:",e),this.handleYouTubeError({data:153},s)}}else{const e=t.querySelector("iframe"),o=document.getElementById("youtube-player");if(o&&o.remove(),n&&n.remove(),"youtube"===r||"vimeo"===r){const e=document.querySelector(".video-play-overlay");e&&(e.style.display="none")}if(e)e.src=a;else{const e=document.createElement("iframe");e.width="100%",e.height="100%",e.style.border="0",e.style.position="absolute",e.style.top="0",e.style.left="0",e.allow="autoplay; fullscreen; picture-in-picture",e.allowFullscreen=!0,e.src=a,"youtube"===r&&(e.id="youtube-iframe",e.onerror=()=>{this.handleYouTubeError({data:153},s)}),t.insertBefore(e,t.firstChild)}}else if(n){const e=n.querySelector("source");e&&(e.src=i.src),n.load()}else{const e=document.createElement("video");e.id="mainVideo",e.controls=!0,e.playsInline=!0,e.style.width="100%",e.style.height="100%",e.style.objectFit="contain",e.style.background="#000";const o=document.createElement("source");o.src=i.src,o.type="video/mp4",e.appendChild(o),t.insertBefore(e,t.firstChild)}let c=document.querySelector(".video-play-overlay");c||(c=document.createElement("button"),c.className="video-play-overlay",c.type="button",c.setAttribute("aria-label","Play video"),c.onclick=playMainVideo,c.innerHTML='<svg viewBox="0 0 64 64" width="64" height="64" aria-hidden="true"><circle cx="32" cy="32" r="31" fill="rgba(0,0,0,0.6)" stroke="white" stroke-width="2" /><polygon points="26,20 26,44 46,32" fill="white" /></svg>',t.appendChild(c)),c.style.display="flex","function"==typeof this.initVideoOverlay&&this.initVideoOverlay();const d=document.getElementById("lightboxImage");d&&(d.src="")}else{const e=t.querySelector("iframe");n&&n.remove(),e&&e.remove();const r=document.querySelector(".video-play-overlay");r&&(r.style.display="none");let a=o;if(a){const e=a.closest("picture");if(e&&e.parentElement){const t=document.createElement("img");t.id="mainPhotoImg",t.alt=document.querySelector(".property-title")?.textContent||"Photo",t.onclick=openLightbox,t.decoding="async",e.parentElement.replaceChild(t,e),a=t}}a||(a=document.createElement("img"),a.id="mainPhotoImg",a.alt=document.querySelector(".property-title")?.textContent||"Photo",a.onclick=openLightbox,a.decoding="async",t.insertBefore(a,t.firstChild)),a.src=i.src,a.removeAttribute("srcset"),a.removeAttribute("sizes");const l=document.getElementById("lightboxImage");l&&(l.src=i.src)}this.currentPhotoIndex=e}initMap(){const e=document.getElementById("propertyMap");if(!e)return;const t=document.getElementById("propertyData"),o=t?.getAttribute("data-latitude"),n=t?.getAttribute("data-longitude"),r=t?.getAttribute("data-map-link");let i=o?parseFloat(o):NaN,a=n?parseFloat(n):NaN;const l=(t,o)=>{try{this.map=L.map("propertyMap").setView([t,o],15),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(this.map);const n=L.marker([t,o]).addTo(this.map),r=document.querySelector(".property-title").textContent,i=document.querySelector(".property-location").textContent.trim();n.bindPopup(`\n          <div style="text-align: center;">\n            <strong>${r}</strong><br>\n            <small>${i}</small>\n          </div>\n        `);const a=e.querySelector(".map-loading");a&&a.remove()}catch(e){console.error("Error initializing map:",e),this.showMapError("Failed to load map")}};if(Number.isFinite(i)&&Number.isFinite(a))return void l(i,a);if(r&&r.trim()){const e=this.extractCoordsFromLink(r);return e&&Number.isFinite(e.lat)&&Number.isFinite(e.lng)?void l(e.lat,e.lng):void this.showMapError("Invalid map link")}const s=document.querySelector(".property-location-map");s&&(s.style.display="none")}extractCoordsFromLink(e){if(!e||"string"!=typeof e)return null;const t=e.trim();let o=t.match(/@\s*(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)/);return o?{lat:Number(o[1]),lng:Number(o[2])}:(o=t.match(/[?&](?:q|ll)=\s*(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)/),o?{lat:Number(o[1]),lng:Number(o[2])}:(o=t.match(/(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)/),o?{lat:Number(o[1]),lng:Number(o[2])}:null))}showMapError(e){const t=document.getElementById("propertyMap");if(!t)return;const o=t.querySelector(".map-loading");o&&(o.innerHTML=`\n        <div style="text-align: center; color: #dc3545;">\n          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <circle cx="12" cy="12" r="10"></circle>\n            <line x1="15" y1="9" x2="9" y2="15"></line>\n            <line x1="9" y1="9" x2="15" y2="15"></line>\n          </svg>\n          <p>${e}</p>\n        </div>\n      `)}loadSimilarProperties(){if(!document.getElementById("similarProperties"))return;const e=document.querySelector(".location-item:first-child strong").nextSibling.textContent.trim(),t=document.querySelector(".location-item:nth-child(2) strong").nextSibling.textContent.trim();fetch(`/properties/api/similar?country=${encodeURIComponent(e)}&city=${encodeURIComponent(t)}&exclude=${this.propertyId}&limit=3`).then(e=>e.json()).then(e=>{e.success&&e.properties.length>0?this.renderSimilarProperties(e.properties):this.showSimilarPropertiesError()}).catch(e=>{console.error("Error loading similar properties:",e),this.showSimilarPropertiesError()})}incrementView(){const e=this.propertyId;e&&fetch(`/properties/api/${encodeURIComponent(e)}/view`,{method:"POST",headers:{"CSRF-Token":document.querySelector('meta[name="csrf-token"]').getAttribute("content")||""}}).catch(()=>{})}renderSimilarProperties(e){const t=document.getElementById("similarProperties");t&&(t.innerHTML=e.map(e=>`\n      <div class="similar-property" onclick="window.location.href='/properties/${e.slug}'">\n        <div class="similar-property-image">\n          <img src="${e.photos&&e.photos.length>0?e.photos[0]:"/img/property-placeholder.jpg"}" \n               alt="${e.title}" loading="lazy" decoding="async">\n        </div>\n        <div class="similar-property-content">\n          <h4>${e.title}</h4>\n          <p class="similar-property-location">${e.neighborhood}, ${e.city}</p>\n          <p class="similar-property-price">€${Number(e.price||0).toLocaleString("en-US")}</p>\n        </div>\n      </div>\n    `).join(""))}initRecaptcha(){try{const e=document.getElementById("recaptchaTokenProperty"),t=e?e.getAttribute("data-site-key"):null;if(!t||!window.grecaptcha||"function"!=typeof grecaptcha.ready)return;grecaptcha.ready(function(){grecaptcha.execute(t,{action:"property_lead"}).then(function(t){e&&(e.value=t)})})}catch(e){}}showSimilarPropertiesError(){const e=document.getElementById("similarProperties");e&&(e.innerHTML='\n      <div class="similar-properties-error">\n        <p>No similar properties available at the moment.</p>\n      </div>\n    ')}bindEvents(){const e=document.getElementById("contactForm");e&&e.addEventListener("submit",this.handleContactFormSubmit.bind(this));const t=document.querySelector(".gallery-nav.prev"),o=document.querySelector(".gallery-nav.next");t&&t.addEventListener("click",()=>previousPhoto()),o&&o.addEventListener("click",()=>nextPhoto()),document.querySelectorAll(".gallery-thumbnails .thumbnail").forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.getAttribute("data-index"),10);Number.isNaN(t)||showPhoto(t)})});const n=document.getElementById("mainPhotoImg");n&&n.addEventListener("click",()=>openLightbox());const r=document.getElementById("lightbox");if(r){const e=r.querySelector(".lightbox-close"),t=r.querySelector(".lightbox-prev"),o=r.querySelector(".lightbox-next");e&&e.addEventListener("click",()=>closeLightbox()),t&&t.addEventListener("click",()=>previousPhoto()),o&&o.addEventListener("click",()=>nextPhoto())}const i=document.querySelector(".video-play-overlay");i&&i.addEventListener("click",()=>playMainVideo());const a=document.querySelector(".js-share-btn");a&&a.addEventListener("click",()=>shareProperty());const l=document.querySelector(".js-contact-btn");l&&l.addEventListener("click",()=>contactAgent());const s=document.getElementById("shareModal");if(s){const e=s.querySelector(".modal-close");e&&e.addEventListener("click",()=>closeShareModal());s.querySelectorAll(".share-option").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-platform");"copy"===t?copyLink():shareOnSocial(t)})})}const c=document.querySelector(".plan-button");c&&c.addEventListener("click",()=>{const e=c.getAttribute("data-plan-url");e&&openImagePopup(e)})}initDescriptionToggle(){const e=document.getElementById("descriptionContent"),t=document.getElementById("descriptionToggle");if(!e||!t)return;if(!(e.scrollHeight>e.clientHeight+10))return t.style.display="none",void e.classList.remove("collapsed");t.addEventListener("click",()=>{const o=e.classList.toggle("collapsed");t.textContent=o?"Read more":"Read less"})}relocateContactFormOnMobile(){const e=document.getElementById("inlineContactForm"),t=document.querySelector(".mobile-contact-form"),o=document.querySelector(".property-location-map");if(!e||!t||!o)return;const n=()=>{if(window.matchMedia("(max-width: 1024px)").matches)t.style.display="block",o.insertAdjacentElement("afterend",t),t.contains(e)||t.appendChild(e);else{const o=document.querySelector(".property-sidebar");o&&!o.contains(e)&&o.insertBefore(e,o.firstChild),t.style.display="none"}};n(),window.addEventListener("resize",n)}async handleContactFormSubmit(e){if(e.preventDefault(),this.isSubmittingLead)return;this.isSubmittingLead=!0;const t=e.target.querySelector('button[type="submit"]'),o=t?t.innerHTML:"";t&&(t.disabled=!0,t.innerHTML='<span class="spinner" aria-hidden="true"></span> Sending...');const n=new FormData(e.target),r=Object.fromEntries(n.entries());try{const e=document.getElementById("recaptchaTokenProperty"),t=e?e.getAttribute("data-site-key"):null;if(t&&window.grecaptcha&&"function"==typeof grecaptcha.execute){const o=await grecaptcha.execute(t,{action:"property_lead"});o&&(r.recaptchaToken=o,e&&(e.value=o))}else!r.recaptchaToken&&e&&e.value&&(r.recaptchaToken=e.value)}catch(e){if(!r.recaptchaToken){const e=document.getElementById("recaptchaTokenProperty");e&&e.value&&(r.recaptchaToken=e.value)}}if((r.countryCode||r.phone)&&(r.phone=`${r.countryCode||""} ${r.phone||""}`.trim()),!r.language){const e=document.getElementById("contactLanguage");e&&(r.language=e.value||"")}r.propertyId=this.propertyId,r.propertyTitle=document.querySelector(".property-title").textContent,fetch("/api/leads",{method:"POST",headers:{"Content-Type":"application/json","CSRF-Token":document.querySelector('meta[name="csrf-token"]').getAttribute("content")||""},body:JSON.stringify(r)}).then(e=>e.json()).then(t=>{t.success?(window.analytics&&window.analytics.trackFormSubmit&&window.analytics.trackFormSubmit("property_contact",this.propertyId,null,{property_title:r.propertyTitle||""}),this.showSuccessMessage("Thank you! Your inquiry was submitted. A team member will be in touch soon."),"function"==typeof closeContactModal&&closeContactModal(),e.target.reset()):this.showErrorMessage(t.message||"Failed to send message. Please try again.")}).catch(e=>{console.error("Error sending message:",e),this.showErrorMessage("An error occurred. Please try again later.")}).finally(()=>{this.isSubmittingLead=!1,t&&(t.disabled=!1,t.innerHTML=o)})}showSuccessMessage(e){this.showMessage(e,"success")}showErrorMessage(e){this.showMessage(e,"error")}showMessage(e,t){const o=document.createElement("div");o.className=`message message-${t}`,o.textContent=e,document.body.appendChild(o),setTimeout(()=>o.classList.add("show"),100),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>o.remove(),300)},3e3)}}function showPhoto(e){const t="string"==typeof e?parseInt(e,10):e;window.propertyDetailPage&&Number.isFinite(t)&&window.propertyDetailPage.updateMainPhoto(t)}function nextPhoto(){const e=document.querySelectorAll(".thumbnail");if(0===e.length)return;let t=0;window.propertyDetailPage&&(t=(window.propertyDetailPage.currentPhotoIndex+1)%e.length),showPhoto(t)}function previousPhoto(){const e=document.querySelectorAll(".thumbnail");if(0===e.length)return;let t=0;window.propertyDetailPage&&(t=(window.propertyDetailPage.currentPhotoIndex-1+e.length)%e.length),showPhoto(t)}function contactAgent(){const e=document.getElementById("inlineContactForm");if(e){e.scrollIntoView({behavior:"smooth",block:"start"});const t=document.getElementById("contactName");return void(t&&t.focus({preventScroll:!0}))}}function closeContactModal(){const e=document.getElementById("contactModal");e&&(e.classList.remove("show"),document.body.style.overflow="")}function shareProperty(){const e=document.getElementById("shareModal");e&&(e.classList.add("show"),document.body.style.overflow="hidden")}function closeShareModal(){const e=document.getElementById("shareModal");e&&(e.classList.remove("show"),document.body.style.overflow="")}function openImagePopup(e){let t=document.getElementById("imagePopupOverlay");if(!t){t=document.createElement("div"),t.id="imagePopupOverlay",t.style.position="fixed",t.style.inset="0",t.style.background="rgba(0,0,0,.7)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="3000";const e=document.createElement("div");e.style.maxWidth="90vw",e.style.maxHeight="90vh",e.style.position="relative",e.style.boxShadow="0 20px 60px rgba(0,0,0,.5)";const o=document.createElement("img");o.id="imagePopupImg",o.style.maxWidth="100%",o.style.maxHeight="90vh",o.style.borderRadius="8px",o.alt="Plan";const n=document.createElement("button");n.textContent="×",n.setAttribute("aria-label","Close"),n.style.position="absolute",n.style.top="-12px",n.style.right="-12px",n.style.width="36px",n.style.height="36px",n.style.borderRadius="18px",n.style.border="none",n.style.background="#fff",n.style.cursor="pointer",n.style.fontSize="22px",n.style.lineHeight="36px",n.style.boxShadow="0 4px 12px rgba(0,0,0,.25)",n.addEventListener("click",()=>closeImagePopup()),e.appendChild(o),e.appendChild(n),t.appendChild(e),t.addEventListener("click",e=>{e.target===t&&closeImagePopup()}),document.body.appendChild(t)}const o=document.getElementById("imagePopupImg");o&&(o.src=e),t.style.display="flex",document.body.style.overflow="hidden"}function closeImagePopup(){const e=document.getElementById("imagePopupOverlay");e&&(e.style.display="none",document.body.style.overflow="")}function openLightbox(){const e=document.getElementById("lightbox"),t=document.getElementById("lightboxImage"),o=document.getElementById("mainPhotoImg");e&&t&&o&&(t.src=o.src,e.classList.add("show"),document.body.style.overflow="hidden")}function closeLightbox(){const e=document.getElementById("lightbox");e&&(e.classList.remove("show"),document.body.style.overflow="")}function playMainVideo(){const e=document.getElementById("mainVideo"),t=document.querySelector(".video-play-overlay"),o=document.getElementById("mainPhoto"),n=o?.getAttribute("data-video-kind");if("youtube"===n&&window.propertyDetailPage&&window.propertyDetailPage.youtubePlayer)try{window.propertyDetailPage.youtubePlayer.playVideo(),t&&(t.style.display="none")}catch(e){console.error("Error playing YouTube video:",e)}else e&&(e.play(),t&&(t.style.display="none"))}function shareOnSocial(e){const t=document.querySelector(".property-title").textContent,o=window.location.href,n=document.getElementById("propertyData"),r=n?n.getAttribute("data-id"):null;window.analytics&&window.analytics.trackPropertyShare&&window.analytics.trackPropertyShare(r,e);let i="";switch(e){case"facebook":i=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(o)}`;break;case"instagram":const e=`Check out this property: ${t} - ${o}`;navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{window.propertyDetailPage&&window.propertyDetailPage.showSuccessMessage("Property info copied! You can now paste it on Instagram.")}).catch(()=>{fallbackCopyTextToClipboard(e)}):fallbackCopyTextToClipboard(e),i="https://www.instagram.com/";break;case"linkedin":i=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(o)}`}i&&window.open(i,"_blank","width=600,height=400"),closeShareModal()}function copyLink(){const e=window.location.href,t=document.getElementById("propertyData"),o=t?t.getAttribute("data-id"):null;window.analytics&&window.analytics.trackPropertyShare&&window.analytics.trackPropertyShare(o,"copy_link"),navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{window.propertyDetailPage&&window.propertyDetailPage.showSuccessMessage("Link copied to clipboard!")}).catch(()=>{fallbackCopyTextToClipboard(e)}):fallbackCopyTextToClipboard(e),closeShareModal()}function fallbackCopyTextToClipboard(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),window.propertyDetailPage&&window.propertyDetailPage.showSuccessMessage("Link copied to clipboard!")}catch(e){console.error("Fallback: Oops, unable to copy",e),window.propertyDetailPage&&window.propertyDetailPage.showErrorMessage("Failed to copy link")}document.body.removeChild(t)}function callAgent(){const e=document.getElementById("propertyData"),t=e?e.getAttribute("data-id"):null;window.analytics&&window.analytics.trackContactAction&&window.analytics.trackContactAction("phone",t,null),window.propertyDetailPage&&window.propertyDetailPage.showSuccessMessage("Phone functionality coming soon!")}document.addEventListener("DOMContentLoaded",function(){window.propertyDetailPage=new PropertyDetailPage});const messageStyles=document.createElement("style");messageStyles.textContent="\n  .message {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    padding: 1rem 1.5rem;\n    border-radius: 8px;\n    color: white;\n    font-weight: 500;\n    z-index: 1001;\n    transform: translateX(100%);\n    transition: transform 0.3s ease;\n    max-width: 300px;\n  }\n  \n  .message.show {\n    transform: translateX(0);\n  }\n  \n  .message-success { background-color: #16a34a; }\n  .message-error { background-color: #dc2626; }\n  .message-info { background-color: #2563eb; }\n  .spinner { display:inline-block; width:16px; height:16px; border:2px solid rgba(255,255,255,0.4); border-top-color: rgba(255,255,255,1); border-radius:50%; animation: spin 0.8s linear infinite; margin-right:8px; vertical-align:-2px; }\n  @keyframes spin { to { transform: rotate(360deg); } }\n  \n  .similar-property {\n    display: flex;\n    gap: 1rem;\n    padding: 1rem;\n    background: #f8f9fa;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s;\n  }\n  \n  .similar-property:hover {\n    background: #e9ecef;\n    transform: translateY(-2px);\n  }\n  \n  .similar-property-image {\n    width: 80px;\n    height: 60px;\n    border-radius: 6px;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n  \n  .similar-property-image img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n  \n  .similar-property-content {\n    flex: 1;\n  }\n  \n  .similar-property-content h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 1rem;\n    color: #2c3e50;\n  }\n  \n  .similar-property-location {\n    margin: 0 0 0.5rem 0;\n    font-size: 0.9rem;\n    color: #6c757d;\n  }\n  \n  .similar-property-price {\n    margin: 0;\n    font-weight: 600;\n    color: #28a745;\n  }\n  \n  .similar-properties-error {\n    text-align: center;\n    color: #6c757d;\n    padding: 2rem;\n  }\n  \n  /* removed favorited styles (no favorites system) */\n",document.head.appendChild(messageStyles),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("propertyData");if(e&&window.analytics&&window.analytics.trackPropertyView)try{const t=e.getAttribute("data-id"),o=e.getAttribute("data-title")||"",n=parseInt(e.getAttribute("data-price")||"0",10)||0,r=e.getAttribute("data-country")||"",i=e.getAttribute("data-city")||"",a=e.getAttribute("data-neighborhood")||"",l=e.getAttribute("data-type")||"",s=[a,i,r].filter(Boolean).join(", ");window.analytics.trackPropertyView(t,o,n,s,l)}catch(e){console.error("Error tracking property view:",e)}});