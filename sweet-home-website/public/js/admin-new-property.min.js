document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("np-data");let t={};try{t=JSON.parse(e.getAttribute("data-locations")||"{}")}catch(e){t={}}const n=e.getAttribute("data-default-city")||"",d=e.getAttribute("data-default-hood")||"",o=document.getElementById("country"),l=document.getElementById("city"),a=document.getElementById("neighborhood"),i=document.getElementById("type"),c=document.getElementById("is_in_project"),r=document.getElementById("projectWrap"),s=document.getElementById("project_id");function u(){const e=Object.keys(t[o.value]||{});l.innerHTML='<option value="">Select city</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n===e&&(t.selected=!0),l.appendChild(t)}),l.disabled=0===e.length,m()}function m(){const e=(t[o.value]||{})[l.value]||[];a.innerHTML='<option value="">Select neighborhood (optional)</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,d===e&&(t.selected=!0),a.appendChild(t)}),a.disabled=0===e.length}function p(){const e=i.value;[{id:"typeApartment",active:"Apartment"===e},{id:"typeHouseVilla",active:"House"===e||"Villa"===e},{id:"typeLand",active:"Land"===e}].forEach(({id:e,active:t})=>{const n=document.getElementById(e);n&&(n.hidden=!t,n.querySelectorAll("input, select, textarea").forEach(e=>{e.disabled=!t}))});const t="Apartment"===e,n="House"===e||"Villa"===e,d="Land"===e,o=document.getElementById("apartment_size"),l=document.getElementById("rooms_a"),a=document.getElementById("bathrooms_a");o&&(o.required=t),l&&(l.required=t),a&&(a.required=t);const c=document.getElementById("total_size"),r=document.getElementById("rooms_hv"),s=document.getElementById("bathrooms_hv");c&&(c.required=n),r&&(r.required=n),s&&(s.required=n);const u=document.getElementById("land_size");u&&(u.required=d)}function y(){const e=!!c.checked;r.hidden=!e,s.required=e,s.disabled=!e,e||(s.value="")}o.addEventListener("change",u),l.addEventListener("change",m),i.addEventListener("change",p),c.addEventListener("change",y);const E=document.getElementById("photos"),g=document.getElementById("photoPreview");let v=null,h=[];function f(){const e=new DataTransfer;h.forEach(t=>e.items.add(t)),E.files=e.files}function b(){g.innerHTML="",h.forEach((e,t)=>{const n=URL.createObjectURL(e),d=document.createElement("div");d.className="item",d.style.position="relative",d.draggable=!0;const o=document.createElement("img");o.src=n,o.className="thumb";const l=document.createElement("button");l.type="button",l.textContent="×",l.setAttribute("aria-label","Remove"),l.style.position="absolute",l.style.right="6px",l.style.top="6px",l.style.width="24px",l.style.height="24px",l.style.borderRadius="50%",l.style.border="none",l.style.background="rgba(0,0,0,0.6)",l.style.color="#fff",l.style.cursor="pointer",l.addEventListener("click",function(){h.splice(t,1),f(),b()});const a=document.createElement("div");a.className="handle",a.textContent="drag",d.appendChild(o),d.appendChild(l),d.appendChild(a),d.addEventListener("dragstart",()=>{v=t}),d.addEventListener("dragover",e=>{e.preventDefault()}),d.addEventListener("drop",e=>{if(e.preventDefault(),null===v)return;const n=h.splice(v,1)[0];h.splice(t,0,n),f(),v=null,b()}),g.appendChild(d)})}E.addEventListener("change",e=>{Array.from(E.files||[]).forEach(e=>{h.some(t=>t.name===e.name&&t.size===e.size&&t.lastModified===e.lastModified)||h.push(e)}),f(),b()});const L=document.getElementById("videoSrcUpload"),I=document.getElementById("videoSrcLink"),B=document.getElementById("videoUploadWrap"),C=document.getElementById("videoUrlWrap"),x=document.getElementById("video"),_=document.getElementById("video_url"),N=document.getElementById("videoPreview");function R(){const e=L.checked;B.hidden=!e,C.hidden=e,e?(_&&(_.value="",_.disabled=!0),x&&(x.disabled=!1)):(x&&(x.value="",x.disabled=!0),_&&(_.disabled=!1))}L&&L.addEventListener("change",R),I&&I.addEventListener("change",R),x&&x.addEventListener("change",()=>{if(N.innerHTML="",x.files&&x.files[0]){const e=URL.createObjectURL(x.files[0]),t=document.createElement("div");t.style.position="relative",t.style.display="inline-block";const n=document.createElement("video");n.src=e,n.controls=!0,n.playsInline=!0,n.style.maxWidth="100%";const d=document.createElement("button");d.type="button",d.textContent="×",d.setAttribute("aria-label","Remove video"),d.style.position="absolute",d.style.right="6px",d.style.top="6px",d.style.width="24px",d.style.height="24px",d.style.borderRadius="50%",d.style.border="none",d.style.background="rgba(0,0,0,0.6)",d.style.color="#fff",d.style.cursor="pointer",d.addEventListener("click",function(){x.value="",N.innerHTML=""}),t.appendChild(n),t.appendChild(d),N.appendChild(t)}});const U=document.getElementById("floorplan"),H=document.getElementById("floorplanPreview");U&&U.addEventListener("change",()=>{if(H.innerHTML="",U.files&&U.files[0]){const e=URL.createObjectURL(U.files[0]),t=document.createElement("img");t.src=e,t.className="thumb";const n=document.createElement("div");n.className="item",n.appendChild(t),H.appendChild(n)}});const k=document.getElementById("plan_photo_hv"),q=document.getElementById("planPhotoPreviewHV");k&&k.addEventListener("change",()=>{if(q.innerHTML="",k.files&&k.files[0]){const e=URL.createObjectURL(k.files[0]),t=document.createElement("img");t.src=e,t.className="thumb";const n=document.createElement("div");n.className="item",n.appendChild(t),q.appendChild(n)}});const w=document.getElementById("plan_photo"),A=document.getElementById("planPhotoPreview");function M(){const e=(i.value||"").toLowerCase(),t=document.getElementById("featuresSection");if(t){const n="land"===e;t.hidden=n,t.querySelectorAll('input[type="checkbox"][name="features"]').forEach(e=>{e.disabled=n})}}function S(){const e=(i.value||"").toLowerCase(),t=document.getElementById("yearBuiltField"),n=document.getElementById("year_built"),d="land"===e;t&&(t.hidden=d),n&&(n.disabled=d)}function T(){const e=document.getElementById("rental_status"),t=document.getElementById("rentalIncomeWrap"),n=document.getElementById("rental_income"),d=e&&e.value||"",o="rented"===d||"not_rented_potential"===d;t&&(t.hidden=!o),n&&(n.disabled=!o)}w&&w.addEventListener("change",()=>{if(A.innerHTML="",w.files&&w.files[0]){const e=URL.createObjectURL(w.files[0]),t=document.createElement("img");t.src=e,t.className="thumb";const n=document.createElement("div");n.className="item",n.appendChild(t),A.appendChild(n)}});const j=document.getElementById("rental_status");j&&j.addEventListener("change",T);const O=document.getElementById("price"),P=document.getElementById("price_display"),D=new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:2}),F=e=>{if("string"!=typeof e)return null;const t=e.replace(/[^0-9,\.]/g,"").replace(/,/g,".");if(!t)return null;const n=Number(t);return Number.isNaN(n)?null:n};if(O&&O.value){const e=Number(O.value);Number.isNaN(e)||(P.value=D.format(e))}P.addEventListener("input",()=>{const e=F(P.value);O.value=null!==e?String(e.toFixed(2)):""}),P.addEventListener("blur",()=>{const e=F(P.value);if(null===e)return P.value="",void(O.value="");P.value=D.format(e),O.value=String(e.toFixed(2))}),function(){const e=document.getElementById("propertyForm");if(!e)return;let t=!1;e.addEventListener("submit",function(){if(t)return!1;if(!e.checkValidity())return!0;t=!0;const n=document.getElementById("uploadOverlay");n&&(n.hidden=!1,n.style.display="flex");const d=e.querySelector('button[type="submit"]');d&&(d.disabled=!0,d.dataset.originalText=d.textContent||"",d.textContent="Uploading...")},{capture:!0})}(),u(),p(),y(),M(),S(),i.addEventListener("change",M),i.addEventListener("change",S),T()});