let HOME_I18N={};function loadHomeI18n(){try{const e=document.getElementById("i18n-home");if(!e)return;HOME_I18N=JSON.parse(e.getAttribute("data-i18n")||"{}")}catch(e){}}function hGet(e,t){try{return e.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,HOME_I18N)??t}catch(e){return t}}function initializeCityDropdown(){const e=document.getElementById("country"),t=document.getElementById("city"),n=document.getElementById("neighborhood");e&&t&&n?(t.disabled=!0,n.disabled=!0,e.addEventListener("change",function(){const e=this.value;if(t.innerHTML='<option value="">Any City</option>',n.innerHTML='<option value="">Any Neighborhood</option>',e&&window.locations[e]){Object.keys(window.locations[e]).forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),t.disabled=!1,n.disabled=!0}else t.disabled=!0,n.disabled=!0}),t.addEventListener("change",function(){const t=e.value,o=this.value;if(n.innerHTML='<option value="">Any Neighborhood</option>',o&&window.locations[t]&&window.locations[t][o]){const e=window.locations[t][o];console.log("üèòÔ∏è Available neighborhoods:",e),e.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)}),n.disabled=!1}else n.disabled=!0}),console.log("‚úÖ Dropdown initialization complete"),console.log("üéØ Event listeners attached to country and city dropdowns")):console.error("‚ùå One or more dropdown elements not found")}function testDropdowns(){console.log("üß™ Testing dropdowns...");const e=document.getElementById("country"),t=document.getElementById("city"),n=document.getElementById("neighborhood");if(console.log("üîç Dropdown elements found:",{country:e?e.value:"Not found",city:t?t.value:"Not found",neighborhood:n?n.value:"Not found"}),console.log("üîç Dropdown states:",{countryDisabled:e?e.disabled:"N/A",cityDisabled:t?t.disabled:"N/A",neighborhoodDisabled:n?n.disabled:"N/A"}),console.log("üîç Dropdown options:",{countryOptions:e?e.options.length:"N/A",cityOptions:t?t.options.length:"N/A",neighborhoodOptions:n?n.options.length:"N/A"}),console.log("üîç Locations data available:",window.locations),e&&e.value&&window.locations[e.value]){console.log("üß™ Manually populating city dropdown...");const n=Object.keys(window.locations[e.value]);t.innerHTML='<option value="">Any City</option>',n.forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),t.disabled=!1,console.log("‚úÖ City dropdown populated with",n.length,"cities")}}async function loadFeaturedProperties(){const e=document.getElementById("featuredProperties"),t=document.querySelector(".section.featured"),n=document.getElementById("featuredCarousel");if(e&&t){t.style.display="none";try{e.innerHTML='\n      <div class="property-card loading-placeholder">\n        <div class="property-image"></div>\n        <div class="property-content">\n          <div class="property-title"></div>\n          <div class="property-location"></div>\n          <div class="property-price"></div>\n        </div>\n      </div>\n      <div class="property-card loading-placeholder">\n        <div class="property-image"></div>\n        <div class="property-content">\n          <div class="property-title"></div>\n          <div class="property-location"></div>\n          <div class="property-price"></div>\n        </div>\n      </div>\n      <div class="property-card loading-placeholder">\n        <div class="property-image"></div>\n        <div class="property-content">\n          <div class="property-title"></div>\n          <div class="property-location"></div>\n          <div class="property-price"></div>\n        </div>\n      </div>\n    ';const o=await fetch("/properties/api/featured");if(!o.ok)throw new Error("Failed to fetch featured properties");const r=await o.json();if(r.length>=4){t.style.display="",e.innerHTML=r.map(e=>{const t=e.size?`${e.size} m¬≤`:null,n=Number.isFinite(e.rooms)&&null!==e.rooms?`${e.rooms}`:null,o=Number.isFinite(e.bathrooms)&&null!==e.bathrooms?`${e.bathrooms}`:null,r=e.price?formatEuro(e.price):"";return`\n        <article class="property-card">\n          <div class="img-wrap" ${r?`data-price="${r}"`:""}>\n            <img src="${e.photos&&e.photos[0]?e.photos[0]:"/img/property-placeholder.jpg"}" alt="${e.title}" loading="lazy" onerror="this.src='/img/property-placeholder.jpg'">\n          </div>\n          <div class="meta">\n            <div class="title">${e.title}</div>\n            ${r?`<div class="price">${r}</div>`:""}\n            <div class="location">\n              <span class="icon icon-16 icon-inline icon-mask icon-location" style="color: currentColor;"></span>\n              ${e.city}, ${e.country}\n            </div>\n            <div class="features-row">\n              ${t?`\n              <div class="feature">\n                <span class="icon icon-16 icon-inline icon-mask icon-size"></span>\n                <span>${t}</span>\n              </div>`:""}\n              ${n?`\n              <div class="feature">\n                <span class="icon icon-16 icon-inline icon-mask icon-bed"></span>\n                <span>${n} bed${1===Number(n)?"":"s"}</span>\n              </div>`:""}\n              ${o?`\n              <div class="feature">\n                <span class="icon icon-16 icon-inline icon-mask icon-bath"></span>\n                <span>${o} bath${1===Number(o)?"":"s"}</span>\n              </div>`:""}\n            </div>\n            <a class="learn-more" href="/properties/${e.slug}">Learn more ‚Üí</a>\n          </div>\n        </article>`}).join(""),markCenterCard(e);try{window.dispatchEvent(new Event("resize"))}catch(e){}const o=n?.querySelector(".cards-track");o&&requestAnimationFrame(()=>{const e=[...o.querySelectorAll(".property-card:not(.loading-placeholder)")];if(e.length>=2){const t=e[1],n=t.offsetLeft+t.offsetWidth/2-o.clientWidth/2,r=Math.max(0,o.scrollWidth-o.clientWidth),i=Math.max(0,Math.min(n,r));o.scrollTo({left:i,behavior:"auto"}),markCenterCard(o)}})}else t.style.display="none"}catch(e){console.error("Error loading featured properties:",e),t&&(t.style.display="none")}}}function initializeSearchForm(){const e=document.querySelector(".search-form");e?(console.log("üîç Initializing search form..."),e.addEventListener("submit",function(e){e.preventDefault(),console.log("üîç Search form submitted");const t=new FormData(this),n=new URLSearchParams;for(let[e,o]of t.entries())o&&""!==o.trim()&&(n.append(e,o),console.log(`üîç Adding search parameter: ${e} = ${o}`));const o=`/properties?${n.toString()}`;console.log("üîç Redirecting to:",o),window.location.href=o}),console.log("‚úÖ Search form initialized")):console.warn("‚ùå Search form not found")}function formatPrice(e){return e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"}document.addEventListener("DOMContentLoaded",function(){try{"scrollRestoration"in history&&(history.scrollRestoration="manual")}catch(e){}window.scrollTo({top:0,left:0,behavior:"auto"}),loadHomeI18n(),window.locations={};const e=document.getElementById("locations-data");if(e)try{window.locations=JSON.parse(e.getAttribute("data-locations")||"{}")}catch(e){window.locations={}}if(!window.locations||"object"!=typeof window.locations||0===Object.keys(window.locations).length)return void console.error("‚ùå Invalid or empty locations data:",window.locations);initializeCityDropdown();const t=document.querySelector(".site-header");function n(){if(!t)return;window.scrollY>40?t.classList.add("shrink"):t.classList.remove("shrink")}n(),window.addEventListener("scroll",n,{passive:!0});(window.requestIdleCallback||function(e){return setTimeout(e,1)})(()=>{loadFeaturedProperties(),initCardsCarousel("#featuredCarousel"),initCardsCarousel("#testimonialsCarousel");const e=document.getElementById("intlCarousel");if(e&&"IntersectionObserver"in window){const t=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&(initStretchCarousel("#intlCarousel"),t.disconnect())},{rootMargin:"0px 0px -20% 0px"});t.observe(e)}else initStretchCarousel("#intlCarousel");initMobileHeroSlideshow(),initRecommendedProject(),initializeSearchForm();const t=document.getElementById("mortgageForm");t&&t.addEventListener("submit",function(e){e.preventDefault(),calculateMortgage()})})}),window.addEventListener("pageshow",function(e){e.persisted&&window.scrollTo({top:0,left:0,behavior:"auto"})}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})});const observerOptions={threshold:.1,rootMargin:"0px 0px -50px 0px"},observer=new IntersectionObserver(function(e){e.forEach(e=>{e.isIntersecting&&e.target.classList.add("fade-in")})},observerOptions);function parseEuro(e){if(null==e)return 0;const t=e.toString().replace(/[^0-9]/g,""),n=parseInt(t,10);return isNaN(n)?0:n}function formatEuro(e){try{const t=(document.documentElement.getAttribute("lang")||"en").toLowerCase(),n={en:"en-US",es:"es-ES",de:"de-DE"}[t]||"en-US";return new Intl.NumberFormat(n,{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(Math.max(0,Math.round(e)))}catch(t){return`‚Ç¨${formatPrice(Math.max(0,Math.round(e)))}`}}function calculateMortgage(){const e=parseEuro(document.getElementById("propertyPrice").value),t=parseEuro(document.getElementById("downPayment").value),n=parseInt(document.getElementById("loanTerm").value)||30,o=parseFloat(document.getElementById("interestRate").value)||0;if(e<=0||t<0||o<=0)return void alert(hGet("calc.errors.invalid","Please enter valid values for all fields."));if(t>=e)return void alert(hGet("calc.errors.downTooHigh","Down payment cannot be greater than or equal to property price."));const r=e-t,i=o/100/12,a=12*n;let s=0;i>0&&(s=r*(i*Math.pow(1+i,a))/(Math.pow(1+i,a)-1));const l=s*a-r,c=s*a,d=.015*e/12,u=.0075*e/12,p=s+d+u;document.getElementById("monthlyPayment").textContent=formatEuro(s),document.getElementById("propertyTax").textContent=formatEuro(d),document.getElementById("insurance").textContent=formatEuro(u),document.getElementById("totalPayment").textContent=formatEuro(p),document.getElementById("loanAmount").textContent=formatEuro(r),document.getElementById("totalInterest").textContent=formatEuro(l),document.getElementById("totalCost").textContent=formatEuro(c);const m=document.getElementById("calculatorResults"),h=m?.closest(".calculator-container");m&&(m.style.display="block"),h&&h.classList.add("has-results"),document.getElementById("calculatorResults").scrollIntoView({behavior:"smooth",block:"start"})}function initCardsCarousel(e){const t=document.querySelector(e);if(!t)return;const n=t.querySelector(".cards-track"),o=t.querySelector(".prev"),r=t.querySelector(".next"),i=()=>[...n.querySelectorAll(".property-card, .testimonial-card")],a="featuredCarousel"===t.id;let s=!1;function l(e){const t=i();if(!t.length)return;const o=t[Math.max(0,Math.min(t.length-1,e))],r=o.offsetLeft+o.offsetWidth/2-n.clientWidth/2,a=Math.max(0,n.scrollWidth-n.clientWidth),s=Math.max(0,Math.min(r,a));n.scrollTo({left:s,behavior:"smooth"})}function c(){const e=i();if(!e.length)return 0;const t=n.scrollLeft+n.clientWidth/2;let o=1/0,r=0;return e.forEach((e,n)=>{const i=e.offsetLeft+e.offsetWidth/2,a=Math.abs(i-t);a<o&&(o=a,r=n)}),r}if(n.classList.add("no-scrollbar"),!document.getElementById("no-scrollbar-style")){const e=document.createElement("style");e.id="no-scrollbar-style",e.textContent=".no-scrollbar{scrollbar-width:none;-ms-overflow-style:none}.no-scrollbar::-webkit-scrollbar{display:none}",document.head.appendChild(e)}function d(){const e=i()[0];if(!e)return;let t=n.querySelector(".edge-spacer.left"),o=n.querySelector(".edge-spacer.right");t||(t=document.createElement("div"),t.className="edge-spacer left",n.insertBefore(t,n.firstChild)),o||(o=document.createElement("div"),o.className="edge-spacer right",n.appendChild(o));const r=window.getComputedStyle(n),a=parseFloat(r.gap||r.columnGap||"0")||0,s=Math.max(0,(n.clientWidth-e.offsetWidth)/2-a/2);t.style.flex="0 0 "+s+"px",o.style.flex="0 0 "+s+"px"}d(),window.addEventListener("resize",d);new MutationObserver(()=>{requestAnimationFrame(()=>{if(d(),a&&!s){i().length>=2&&(l(1),s=!0)}markCenterCard(n)})}).observe(n,{childList:!0}),o?.addEventListener("click",()=>{l(c()-1)}),r?.addEventListener("click",()=>{l(c()+1)}),n?.addEventListener("scroll",()=>markCenterCard(n)),n?.addEventListener("click",e=>{const t=e.target.closest(".property-card, .testimonial-card");if(!t||!n.contains(t))return;const o=i().indexOf(t);o>=0&&l(o)}),setTimeout(()=>{if(d(),a&&!s){i().length>=2&&(l(1),s=!0)}markCenterCard(n)},0)}function markCenterCard(e){const t=[...e.querySelectorAll(".property-card, .testimonial-card")];if(!t.length)return;const n=e.scrollLeft+e.clientWidth/2;let o=null,r=1/0;t.forEach(e=>{const t=e.offsetLeft+e.offsetWidth/2,i=Math.abs(t-n);i<r&&(r=i,o=e),e.classList.remove("is-center")}),o?.classList.add("is-center")}function initStretchCarousel(e){const t=document.querySelector(e);if(!t)return;const n=[...t.querySelector(".stretch-track").querySelectorAll(".stretch-card")],o=t.querySelector(".prev"),r=t.querySelector(".next");let i=n.findIndex(e=>e.classList.contains("is-focused"));function a(e){n.forEach((t,n)=>t.classList.toggle("is-focused",n===e)),n[e]?.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}i<0&&(i=1),a(i),o?.addEventListener("click",()=>{i=(i-1+n.length)%n.length,a(i)}),r?.addEventListener("click",()=>{i=(i+1)%n.length,a(i)}),n.forEach((e,t)=>e.addEventListener("click",()=>{i=t,a(i)}))}function initRecommendedProject(){const e=document.querySelector(".project-hero");if(!e)return;const t=[...e.querySelectorAll(".slide")];if(t.length<=1)return;const n=e.querySelector(".ctrl.prev"),o=e.querySelector(".ctrl.next");let r=0;function i(e){var n;r=(r+e+t.length)%t.length,n=r,t.forEach((e,t)=>e.classList.toggle("is-active",t===n))}n&&n.addEventListener("click",()=>{i(-1)}),o&&o.addEventListener("click",()=>{i(1)})}function initMobileHeroSlideshow(){const e=window.matchMedia("(max-width: 560px)"),t=document.querySelector(".hero-panels");if(!t)return;const n=[...t.querySelectorAll(".panel")];if(!n.length)return;let o=null,r=0;function i(){n.forEach((e,t)=>e.classList.toggle("is-active",t===r))}function a(){o&&(clearInterval(o),o=null),e.matches?(r=0,i(),o=setInterval(()=>{r=(r+1)%n.length,i()},5e3)):n.forEach(e=>e.classList.remove("is-active"))}e.addEventListener?e.addEventListener("change",a):e.addListener(a),a()}function initSocialMediaBar(){const e=document.getElementById("socialBar");if(!e)return;let t=window.scrollY,n=!1;function o(){const o=window.scrollY,r=o>t?"down":"up",i=window.innerWidth<=768;"down"===r&&o>200?(e.style.transform=i?"translateX(-50%) translateY(100px)":"translateY(-50%) translateX(100px)",e.style.opacity="0"):(e.style.transform=i?"translateX(-50%) translateY(0)":"translateY(-50%) translateX(0)",e.style.opacity="0.9"),t=o,n=!1}window.addEventListener("scroll",function(){n||(requestAnimationFrame(o),n=!0)},{passive:!0});e.querySelectorAll(".social-link").forEach(e=>{e.addEventListener("click",function(e){const t=this.classList[1];console.log(`Social media click: ${t}`)})}),e.addEventListener("mouseenter",function(){const e=window.innerWidth<=768;this.style.transform=e?"translateX(-50%) scale(1.05)":"translateY(-50%) scale(1.05)",this.style.opacity="1"}),e.addEventListener("mouseleave",function(){const e=window.innerWidth<=768;this.style.transform=e?"translateX(-50%) scale(1)":"translateY(-50%) scale(1)",this.style.opacity="0.9"}),window.addEventListener("resize",function(){const t=window.innerWidth<=768,n=e.style.opacity||"0.9";e.style.transform=t?"translateX(-50%) scale(1)":"translateY(-50%) scale(1)",e.style.opacity=n})}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".service-card, .property-card").forEach(e=>observer.observe(e))}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("propertyPrice"),t=document.getElementById("downPayment"),n=document.getElementById("interestRate");function o(e){const t=e.selectionStart,n=e.value.replace(/[^0-9]/g,"");e.value=n;try{e.setSelectionRange(t,t)}catch(e){}}e&&(e.addEventListener("input",()=>o(e)),e.addEventListener("blur",()=>function(e){const t=parseEuro(e.value);e.value=t?formatEuro(t):""}(e)),e.addEventListener("focus",()=>{const t=parseEuro(e.value);e.value=t?String(t):""})),t&&(t.addEventListener("input",()=>o(t)),t.addEventListener("blur",()=>{const n=parseEuro(e?.value||0);let o=parseEuro(t.value);o>n&&(o=n),t.value=o?formatEuro(o):""}),t.addEventListener("focus",()=>{const e=parseEuro(t.value);t.value=e?String(e):""})),n&&n.addEventListener("input",function(){const e=parseFloat(this.value);isNaN(e)||(e<0&&(this.value=String(0)),e>25&&(this.value=String(25)))})}),document.addEventListener("DOMContentLoaded",function(){initSocialMediaBar()});