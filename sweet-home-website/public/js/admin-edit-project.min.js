document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("proj-data");let t={};try{t=JSON.parse(e.getAttribute("data-locations")||"{}")}catch(g){t={}}const n=e.getAttribute("data-default-city")||"",o=e.getAttribute("data-default-hood")||"",i=document.getElementById("country"),r=document.getElementById("city"),a=document.getElementById("neighborhood");function l(){const e=Object.keys(t[i.value]||{});r.innerHTML='<option value="">Select city</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n===e&&(t.selected=!0),r.appendChild(t)}),r.disabled=0===e.length,d()}function d(){const e=(t[i.value]||{})[r.value]||[];a.innerHTML='<option value="">Select neighborhood (optional)</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,o===e&&(t.selected=!0),a.appendChild(t)}),a.disabled=0===e.length}function s(e,t){const n=document.getElementById(e),o=document.getElementById(t),i=new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:2}),r=e=>{if("string"!=typeof e)return null;const t=e.replace(/[^0-9,\.]/g,"").replace(/,/g,".");if(!t)return null;const n=Number(t);return Number.isNaN(n)?null:n};if(o&&o.value){const e=Number(o.value);Number.isNaN(e)||(n.value=i.format(e))}n.addEventListener("input",()=>{const e=r(n.value);o.value=null!==e?String(e.toFixed(2)):""}),n.addEventListener("blur",()=>{const e=r(n.value);if(null===e)return n.value="",void(o.value="");n.value=i.format(e),o.value=String(e.toFixed(2))})}i.addEventListener("change",l),r.addEventListener("change",d),l(),s("min_price_display","min_price"),s("max_price_display","max_price");const c=document.getElementById("project_photos"),u=document.getElementById("projPhotoPreview");if(c&&u){const v=document.getElementById("orderedExistingPhotos");let h=null;function m(){Array.from(u.querySelectorAll(".item")).forEach((e,t)=>{e.draggable=!0,e.addEventListener("dragstart",t=>{h=e,e.classList.add("dragging"),t.dataTransfer&&(t.dataTransfer.effectAllowed="move")}),e.addEventListener("dragend",()=>{h&&h.classList.remove("dragging"),h=null,f()}),e.addEventListener("dragover",e=>{e.preventDefault()}),e.addEventListener("drop",t=>{if(t.preventDefault(),!h||h===e)return;const n=e.parentNode||u,o=Array.from(u.children),i=o.indexOf(h),r=o.indexOf(e);i<0||r<0||(i<r?n.insertBefore(h,e.nextSibling):n.insertBefore(h,e),h&&h.classList.remove("dragging"),h=null,m(),f())})})}function f(){if(!v)return;v.innerHTML="";Array.from(u.querySelectorAll(".item")).forEach(e=>{const t=e.querySelector("img.thumb");if(!t)return;const n=document.createElement("input");if(n.type="hidden",n.name="photos_order","1"===e.getAttribute("data-new")){const t=Array.from(c.files||[]).findIndex(t=>String(t.name)===e.dataset.fileName&&String(t.size)===e.dataset.fileSize&&String(t.lastModified)===e.dataset.fileLastMod);if(!(t>=0))return;n.value="file:"+t}else{const e=t.getAttribute("src");if(!e)return;n.value="url:"+e}v.appendChild(n)})}c.addEventListener("change",()=>{u.querySelectorAll('.item[data-new="1"]').forEach(e=>e.remove());Array.from(c.files||[]).forEach(e=>{const t=URL.createObjectURL(e),n=document.createElement("div");n.className="item",n.setAttribute("data-new","1"),n.dataset.fileName=e.name,n.dataset.fileSize=String(e.size),n.dataset.fileLastMod=String(e.lastModified),n.style.position="relative";const o=document.createElement("img");o.src=t,o.className="thumb";const i=document.createElement("button");i.type="button",i.textContent="×",i.setAttribute("aria-label","Remove"),i.style.position="absolute",i.style.right="6px",i.style.top="6px",i.style.width="24px",i.style.height="24px",i.style.borderRadius="50%",i.style.border="none",i.style.background="rgba(0,0,0,0.6)",i.style.color="#fff",i.style.cursor="pointer",i.addEventListener("click",function(){const t=Array.from(c.files||[]),o=t.findIndex(t=>t.name===e.name&&t.size===e.size&&t.lastModified===e.lastModified);if(o>=0){t.splice(o,1);const e=new DataTransfer;t.forEach(t=>e.items.add(t)),c.files=e.files,u.querySelectorAll('.item[data-new="1"]').forEach(e=>e.remove()),Array.from(c.files||[]).forEach(e=>{const t=URL.createObjectURL(e),n=document.createElement("div");n.className="item",n.setAttribute("data-new","1"),n.style.position="relative";const o=document.createElement("img");o.src=t,o.className="thumb";const i=document.createElement("button");i.type="button",i.textContent="×",i.setAttribute("aria-label","Remove"),i.style.position="absolute",i.style.right="6px",i.style.top="6px",i.style.width="24px",i.style.height="24px",i.style.borderRadius="50%",i.style.border="none",i.style.background="rgba(0,0,0,0.6)",i.style.color="#fff",i.style.cursor="pointer",i.addEventListener("click",function(){const t=Array.from(c.files||[]),n=t.findIndex(t=>t.name===e.name&&t.size===e.size&&t.lastModified===e.lastModified);if(n>=0){t.splice(n,1);const e=new DataTransfer;t.forEach(t=>e.items.add(t)),c.files=e.files,u.querySelectorAll('.item[data-new="1"]').forEach(e=>e.remove()),Array.from(c.files||[]).forEach(e=>{const t=URL.createObjectURL(e),n=document.createElement("div");n.className="item",n.setAttribute("data-new","1"),n.style.position="relative";const o=document.createElement("img");o.src=t,o.className="thumb";const i=document.createElement("button");i.type="button",i.textContent="×",i.setAttribute("aria-label","Remove"),i.style.position="absolute",i.style.right="6px",i.style.top="6px",i.style.width="24px",i.style.height="24px",i.style.borderRadius="50%",i.style.border="none",i.style.background="rgba(0,0,0,0.6)",i.style.color="#fff",i.style.cursor="pointer",i.addEventListener("click",function(){}),n.appendChild(o),n.appendChild(i),u.appendChild(n)})}}),n.appendChild(o),n.appendChild(i),u.appendChild(n)})}else n.remove()}),n.appendChild(o),n.appendChild(i),u.appendChild(n)}),m(),f()}),m(),f()}document.addEventListener("click",function(e){const t=e.target.closest("[data-remove-photo]");if(t){const e=t.getAttribute("data-remove-photo"),n=document.getElementById("remove_existing_photos");if(n){const t=n.value?n.value.split("\n"):[];t.includes(e)||t.push(e),n.value=t.join("\n")}const o=t.closest(".item");o&&o.remove()}if(e.target.closest("[data-remove-video]")){const e=document.getElementById("remove_existing_video");e&&(e.value="true");const t=document.getElementById("projVideoPreview");t&&(t.innerHTML="")}});const p=document.getElementById("project_video"),y=document.getElementById("projVideoPreview");p&&p.addEventListener("change",()=>{if(y.innerHTML="",p.files&&p.files[0]){const e=URL.createObjectURL(p.files[0]),t=document.createElement("div");t.style.position="relative",t.style.display="inline-block";const n=document.createElement("video");n.src=e,n.controls=!0,n.playsInline=!0,n.style.maxWidth="100%";const o=document.createElement("button");o.type="button",o.textContent="×",o.setAttribute("aria-label","Remove video"),o.style.position="absolute",o.style.right="6px",o.style.top="6px",o.style.width="24px",o.style.height="24px",o.style.border="none",o.style.borderRadius="50%",o.style.background="rgba(0,0,0,0.6)",o.style.color="#fff",o.style.cursor="pointer",o.addEventListener("click",function(){p.value="",y.innerHTML="";const e=document.getElementById("remove_existing_video");e&&(e.value="true")}),t.appendChild(n),t.appendChild(o),y.appendChild(t)}}),function(){const e=document.getElementById("projectForm");if(!e)return;let t=!1;e.addEventListener("submit",function(){if(t)return!1;if(!e.checkValidity())return!0;t=!0;const n=document.getElementById("uploadOverlay");if(n)try{n.parentNode!==document.body&&document.body.appendChild(n),n.style.position="fixed",n.style.inset="0",n.style.zIndex="20000",n.style.display="flex",n.hidden=!1}catch(e){n.hidden=!1,n.style.display="flex"}},{capture:!0})}()});