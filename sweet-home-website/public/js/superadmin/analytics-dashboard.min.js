(()=>{"use strict";let t=[],e="",o=null;function r(){const o=document.querySelector(".analytics-page");if(!o)return;const r=o.dataset.timeSeries||"[]";try{t=JSON.parse(r)}catch(e){t=[]}e=o.dataset.quickRange||""}function n(){const e=[],o=[],r=[],n=[],i=[];return t.forEach(t=>{e.push(function(t){const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}(t.date)),o.push(Number(t.page_views||0)),r.push(Number(t.property_views||0)),n.push(Number(t.project_views||0)),i.push(Number(t.form_submissions||0))}),{labels:e,pageViews:o,propertyViews:r,projectViews:n,formSubmissions:i}}function i(){const e=document.getElementById("trafficChart"),r=document.getElementById("chartLoading"),a=document.getElementById("chartError");if(!e)return;const l=window.Chart&&(window.Chart.Chart||window.Chart)||null;if(!l)return void setTimeout(i,100);if(!t||0===t.length)return void(r&&(r.innerHTML='<p style="margin:0;color:#64748b;">No data available for the selected date range.</p>',r.style.display="block"));const{labels:d,pageViews:s,propertyViews:c,projectViews:u,formSubmissions:f}=n();r&&(r.style.display="none"),a&&(a.style.display="none"),e.style.display="block";try{o&&o.destroy(),o=new l(e,{type:"line",data:{labels:d,datasets:[{label:"Other pages",data:s,borderColor:"#2ea862",backgroundColor:"rgba(46, 168, 98, 0.08)",borderWidth:3,tension:.4,fill:!0,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:"#2ea862",pointBorderColor:"#ffffff",pointBorderWidth:2.5,pointHoverBackgroundColor:"#23824b",pointHoverBorderColor:"#ffffff",pointHoverBorderWidth:3},{label:"Property views",data:c,borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.08)",borderWidth:3,tension:.4,fill:!0,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:"#3b82f6",pointBorderColor:"#ffffff",pointBorderWidth:2.5,pointHoverBackgroundColor:"#2563eb",pointHoverBorderColor:"#ffffff",pointHoverBorderWidth:3},{label:"Project views",data:u,borderColor:"#f59e0b",backgroundColor:"rgba(245, 158, 11, 0.08)",borderWidth:3,tension:.4,fill:!0,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:"#f59e0b",pointBorderColor:"#ffffff",pointBorderWidth:2.5,pointHoverBackgroundColor:"#d97706",pointHoverBorderColor:"#ffffff",pointHoverBorderWidth:3},{label:"Form submissions",data:f,borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.08)",borderWidth:3,tension:.4,fill:!0,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:"#ef4444",pointBorderColor:"#ffffff",pointBorderWidth:2.5,pointHoverBackgroundColor:"#dc2626",pointHoverBorderColor:"#ffffff",pointHoverBorderWidth:3}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{y:{beginAtZero:!0,ticks:{stepSize:1,font:{size:12,weight:"500"},color:"#64748b",padding:8},grid:{color:"rgba(46, 168, 98, 0.08)",drawBorder:!1,lineWidth:1}},x:{ticks:{font:{size:12,weight:"500"},color:"#64748b",padding:8},grid:{display:!1}}},plugins:{legend:{position:"bottom",labels:{padding:15,font:{size:12,weight:"500"},usePointStyle:!0,pointStyle:"circle"}},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.98)",padding:14,titleFont:{size:13,weight:"700"},bodyFont:{size:12,weight:"500"},borderColor:"#2ea862",borderWidth:2,cornerRadius:10,displayColors:!0,titleColor:"#ffffff",bodyColor:"#f1f5f9",titleSpacing:6,bodySpacing:4,boxPadding:8}}}})}catch(t){e.style.display="none",r&&(r.style.display="none"),a&&(a.innerHTML=`<p style="margin:0;color:#ef4444;">Error loading chart: ${t.message}</p>`,a.style.display="block")}}document.addEventListener("DOMContentLoaded",()=>{r(),function(){const t=document.getElementById("date_from"),o=document.getElementById("date_to"),r=document.querySelectorAll(".quick-ranges button");if(!t||!o||!r.length)return;const n=t=>t?new Date(`${t}T00:00:00`):null,i=t=>{r.forEach(e=>{e.classList.toggle("active",e.getAttribute("data-range")===t)})},a=()=>{const e=n(t.value),r=n(o.value);if(!e||!r)return null;const i=new Date;i.setHours(0,0,0,0);const a=Math.round((r-e)/864e5)+1;if(1===a&&r.getTime()===i.getTime())return"today";if(r.getTime()===i.getTime()){const t=[7,30,90,365].find(t=>a===t);if(t)return String(t)}const l=new Date(i.getFullYear(),0,1);return r.getTime()===i.getTime()&&e.getTime()===l.getTime()?"ytd":null},l=()=>{const t=a();i(t||"")};if(e)i(e);else{const t=a();t&&i(t)}t.addEventListener("change",l),o.addEventListener("change",l),r.forEach(t=>{t.addEventListener("click",()=>i(t.getAttribute("data-range")))})}(),function(){let t=0;const e=document.getElementById("chartLoading"),o=document.getElementById("chartError"),r=()=>{t+=1,window.Chart&&(window.Chart.Chart||"function"==typeof window.Chart)?i():t<50?setTimeout(r,100):(e&&(e.style.display="none"),o&&(o.innerHTML='<p style="margin:0;color:#ef4444;">Failed to load chart library. Please refresh the page.</p>',o.style.display="block"))};r()}(),document.querySelectorAll(".sortable-table").forEach(t=>{const e=t.querySelectorAll("th.sortable"),o=t.querySelector("tbody");e.forEach(t=>{t.addEventListener("click",()=>{const r=t.getAttribute("data-column"),n=t.getAttribute("data-sort"),i="views"===r||"leads"===r;e.forEach(t=>{t.removeAttribute("data-sort"),t.querySelector(".sort-indicator").textContent=""});const a="asc"===n?"desc":"asc";t.setAttribute("data-sort",a);const l=Array.from(o.querySelectorAll("tr"));l.sort((t,e)=>{let o,n;return"title"===r||"name"===r?(o=t.getAttribute(`data-${r}`)||"",n=e.getAttribute(`data-${r}`)||""):"location"===r?(o=t.getAttribute("data-location")||"",n=e.getAttribute("data-location")||""):(o=parseFloat(t.getAttribute(`data-${r}`)||0),n=parseFloat(e.getAttribute(`data-${r}`)||0)),i?"asc"===a?o-n:n-o:o<n?"asc"===a?-1:1:o>n?"asc"===a?1:-1:0}),l.forEach(t=>o.appendChild(t))})})}),function(){document.querySelectorAll(".filter-toggle-btn").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const o=t.getAttribute("data-target");if(!o)return;const r=document.getElementById(o);if(!r)return;const n="none"===r.style.display||!r.style.display;r.style.display=n?"block":"none"})});const t=document.getElementById("analyticsFilterForm");t&&document.querySelectorAll('.section-filters button[type="submit"].btn-primary').forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const o=new URLSearchParams,r=new FormData(t);for(const[t,e]of r.entries())e&&o.set(t,e);document.querySelectorAll(".section-filters").forEach(t=>{t.querySelectorAll("input, select").forEach(t=>{t.name&&(t.value&&""!==t.value.trim()?o.set(t.name,t.value):o.delete(t.name))})}),window.location.href=t.action+"?"+o.toString()})})}()})})();