document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("area-roles"),t={};try{t=e?JSON.parse(e.textContent||"{}"):{}}catch(e){t={}}var n=document.getElementById("areaSelect"),a=document.getElementById("positionSelect"),i=document.getElementById("profile_picture"),o=document.getElementById("profilePreview"),r=document.getElementById("fileHelpText"),d=document.getElementById("email"),l=document.getElementById("emailError"),c=document.getElementById("password"),s=document.getElementById("passwordConfirm"),u=document.getElementById("passwordError"),m=document.querySelector(".auth-form");if(n&&a){var y=function(e){var n=t&&e&&t[e]?t[e]:[];a.innerHTML="",n&&n.length?(a.disabled=!1,a.appendChild(new Option("-- Select Position --","")),n.forEach(function(e){a.appendChild(new Option(e,e))})):(a.disabled=!0,a.innerHTML="<option>Choose an area first</option>")};y(n.value),n.addEventListener("change",function(){y(n.value)})}if(i&&o&&i.addEventListener("change",function(e){var t=e.target.files&&e.target.files[0];if(!t)return o.style.display="none",void(r&&(r.style.display="block"));r&&(r.style.display="none");var n=(t.name||"").toLowerCase(),a=n.endsWith(".heic")||n.endsWith(".heif"),i=new FileReader;i.onload=function(e){!async function(){try{if(a){var n=await new Promise(function(e,t){if(window.heic2any)return e(window.heic2any);var n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js",n.onload=function(){e(window.heic2any)},n.onerror=t,document.head.appendChild(n)}),i=new Blob([e.target.result]),r=await n({blob:i,toType:"image/jpeg",quality:.8});o.dataset.urlrev&&URL.revokeObjectURL(o.dataset.urlrev);var d=URL.createObjectURL(r);o.dataset.urlrev=d,o.src=d}else o.src=e.target.result;o.style.display="block"}catch(n){try{var l=new Blob([e.target.result],{type:t.type||"application/octet-stream"}),c=URL.createObjectURL(l);o.src=c,o.style.display="block"}catch(e){o.style.display="none"}}}()},a?i.readAsArrayBuffer(t):i.readAsDataURL(t)}),c&&s&&u&&s.addEventListener("blur",function(){u.textContent=c.value&&c.value!==s.value?"Passwords do not match":""}),d&&l&&d.addEventListener("blur",function(){var e=(d.value||"").trim();e?fetch("/auth/check-email?email="+encodeURIComponent(e),{headers:{"X-CSRF-Token":window.__CSRF_TOKEN__||""}}).then(function(e){return e.ok?e.json():{exists:!1}}).then(function(e){l.textContent=e&&e.exists?"Email already in use":""}).catch(function(){}):l.textContent=""}),m){var p=!1,f=function(){var e=document.getElementById("uploadOverlay");if(e){try{e.parentElement!==document.body&&document.body.appendChild(e)}catch(e){}e.style.zIndex="20000",e.hidden=!1,e.style.display="flex",e.setAttribute("role","dialog"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-busy","true")}var t=m.querySelector('button[type="submit"]');t&&(t.disabled=!0,t.dataset.originalText=t.textContent||"",t.textContent="Submitting...")},v=m.querySelector('button[type="submit"]');v&&v.addEventListener("click",function(){p||("function"!=typeof m.checkValidity||m.checkValidity())&&(p=!0,requestAnimationFrame(f))},{capture:!0}),m.addEventListener("submit",function(e){if(!p){var t=!0;if(c&&s&&u&&c.value&&c.value!==s.value&&(u.textContent="Passwords do not match",t=!1),l&&l.textContent&&(t=!1),!t)return e.preventDefault(),!1;p=!0,f()}},{capture:!0})}});