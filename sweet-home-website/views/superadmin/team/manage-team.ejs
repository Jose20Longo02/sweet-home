<head>
  <link rel="stylesheet" href="/css/superadmin/manage-team.css" />
</head>

<!-- views/admin/team/list.ejs -->
<% title = 'Team Management' %>


<div class="admin-panel">
  <div class="admin-body">
    <!-- Sidebar -->
     <%- include('../../partials/superadmin-sidebar', {
      activePage: 'team',     // or 'projects', 'properties', etc.
      pendingCount: pendingCount   // make sure you pass this in your controller
    }) %>

    <!-- Main content -->
    <main class="admin-content">
      <section class="team-container">
        <h1>Team Management</h1>

        <% Object.keys(areaRoles).forEach(function(area) { %>
          <div class="team-area">
            <h2><%= area %></h2>
            <% const areaMembers = members.filter(m => m.area === area); %>

            <% if (areaMembers.length === 0) { %>
              <p class="empty">No team members work in this area.</p>
            <% } else { %>
              <div class="members-grid">
                <% areaMembers.forEach(function(member) { %>
                  <div class="member-card">
                    <img
                      src="<%= member.profile_picture || '/img/default-avatar.png' %>"
                      alt="<%= member.name %>"
                      class="thumb"
                    />
                    <h3><%= member.name %></h3>
                    <p class="position"><%= member.position %></p>

                    <div class="actions">
                      <p class="property-count"><%= member.property_count %> <%= member.property_count === 1 ? 'property' : 'properties' %> assigned</p>
                      <a href="/superadmin/dashboard/properties?agent=<%= member.id %>" class="btn btn-primary">View Properties</a>
                      <% if (member.id !== currentUser.id) { %>
                        <div style="display: flex; gap: 0.5rem;">
                          <form action="/superadmin/dashboard/team/<%= member.id %>/delete" method="post" onsubmit="return confirm('Are you sure you want to delete <%= member.name %>?');" style="flex: 1;">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                            <button type="submit" class="btn btn-danger" style="width: 100%;">Delete</button>
                          </form>
                          <a href="/superadmin/dashboard/team/<%= member.id %>/edit" class="btn btn-secondary" style="flex: 1;">Edit</a>
                        </div>
                      <% } else { %>
                        <a href="/superadmin/dashboard/profile" class="btn btn-secondary" style="width: 100%;">Edit Profile</a>
                      <% } %>
                    </div>
                  </div>
                <% }); %>
              </div>
            <% } %>
          </div>
        <% }); %>

      </section>
    </main>
  </div>
</div>


