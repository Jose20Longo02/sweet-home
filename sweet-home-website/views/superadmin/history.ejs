<head>
  <link rel="stylesheet" href="/css/superadmin/history.css" />
</head>

<% title = 'Activity History' %>

<div class="admin-panel">
  <div class="admin-body">
    <!-- Sidebar -->
    <%- include('../partials/superadmin-sidebar', {
      activePage: 'history',
      pendingCount: pendingCount
    }) %>

    <!-- Main Content -->
    <main class="admin-content">
      <div class="history-header">
        <h1>Activity History</h1>
        <p class="subtitle">Track all team actions on properties and projects</p>
      </div>

      <% if (logs.length === 0) { %>
        <div class="empty-state">
          <p>No activity logs yet.</p>
        </div>
      <% } else { %>
        <div class="history-stats">
          <div class="stat-item">
            <span class="stat-label">Total Activities</span>
            <span class="stat-value"><%= totalCount %></span>
          </div>
        </div>

        <div class="activity-list">
          <% logs.forEach(log => { %>
            <div class="activity-item">
              <div class="activity-icon">
                <% if (log.action_type === 'property_created' || log.action_type === 'project_created') { %>
                  <span class="icon">‚ûï</span>
                <% } else if (log.action_type === 'property_updated' || log.action_type === 'project_updated') { %>
                  <span class="icon">‚úèÔ∏è</span>
                <% } else if (log.action_type === 'property_deleted' || log.action_type === 'project_deleted') { %>
                  <span class="icon">üóëÔ∏è</span>
                <% } else { %>
                  <span class="icon">üìù</span>
                <% } %>
              </div>
              
              <div class="activity-content">
                <div class="activity-header">
                  <span class="activity-action">
                    <% 
                      const actionMap = {
                        'property_created': 'Created Property',
                        'property_updated': 'Updated Property',
                        'property_deleted': 'Deleted Property',
                        'project_created': 'Created Project',
                        'project_updated': 'Updated Project',
                        'project_deleted': 'Deleted Project'
                      };
                    %>
                    <%= actionMap[log.action_type] || log.action_type %>
                  </span>
                  <span class="activity-badge <%= log.entity_type %>">
                    <%= log.entity_type === 'property' ? 'Property' : 'Project' %>
                  </span>
                </div>
                
                <div class="activity-details">
                  <p class="activity-title"><%= log.entity_title || 'Untitled' %></p>
                  <div class="activity-meta">
                    <span class="activity-user">
                      <strong><%= log.user_name || log.current_user_name || 'Unknown User' %></strong>
                    </span>
                    <span class="activity-time">
                      <%= new Date(log.created_at).toLocaleString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                      }) %>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          <% }) %>
        </div>

        <% if (totalPages > 1) { %>
          <div class="pagination">
            <% if (currentPage > 1) { %>
              <a href="?page=<%= currentPage - 1 %>" class="pagination-btn">‚Üê Previous</a>
            <% } else { %>
              <span class="pagination-btn disabled">‚Üê Previous</span>
            <% } %>
            
            <span class="pagination-info">
              Page <%= currentPage %> of <%= totalPages %>
            </span>
            
            <% if (currentPage < totalPages) { %>
              <a href="?page=<%= currentPage + 1 %>" class="pagination-btn">Next ‚Üí</a>
            <% } else { %>
              <span class="pagination-btn disabled">Next ‚Üí</span>
            <% } %>
          </div>
        <% } %>
      <% } %>
    </main>
  </div>
</div>

