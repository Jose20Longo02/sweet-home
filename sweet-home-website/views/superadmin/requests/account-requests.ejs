<!-- views/admin/requests/list.ejs -->
<% title = 'Account Requests' %>
<link rel="stylesheet" href="/css/superadmin/account-requests.css" />

<div class="admin-panel">
  <div class="admin-body">
    <!-- Sidebar -->
    <%- include('../../partials/superadmin-sidebar', {
      activePage: 'requests',     // or 'projects', 'properties', etc.
      pendingCount: pendingCount   // make sure you pass this in your controller
    }) %>

    <!-- Main content -->
<main class="admin-content">
      <section class="requests-container">
        <h1>Pending Account Requests</h1>

        <% if (pendingCount === 0) { %>
          <p class="empty">No pending account requests.</p>
        <% } else { %>
          <div class="requests-grid">
            <% requests.forEach(function(req) { %>
              <div class="request-card">
                <!-- Role selector -->
                <form
                  action="/superadmin/dashboard/requests/<%= req.id %>/role"
                  method="post"
                  class="role-form"
                >
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <select name="role" class="role-select" onchange="this.form.submit()">
                    <option value="Admin"      <%= req.role === 'Admin'      ? 'selected' : '' %>>Admin</option>
                    <option value="SuperAdmin" <%= req.role === 'SuperAdmin' ? 'selected' : '' %>>SuperAdmin</option>
                  </select>
                </form>

                <img
                  src="<%= req.profile_picture || '/img/default-avatar.png' %>"
                  alt="<%= req.name %>"
                  class="thumb"
                />
                <h3><%= req.name %></h3>
                <p class="position"><%= req.position %> — <%= req.area %></p>

                <% if (req.id !== currentUser.id) { %>
                  <div class="actions">
                    <form action="/superadmin/dashboard/requests/<%= req.id %>/approve" method="post">
                      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                      <button type="submit" class="btn btn-primary">Approve</button>
                    </form>
                    <form action="/superadmin/dashboard/requests/<%= req.id %>/reject" method="post">
                      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                      <button type="submit" class="btn btn-danger">Reject</button>
                    </form>
                  </div>
                <% } %>
              </div>
            <% }); %>
          </div>
        <% } %>
      </section>
    </main>
  </div>
</div>

<!-- Action Overlay (Approve/Reject) -->
<div id="actionOverlay" class="upload-overlay" hidden style="display:none;">
  <div class="upload-dialog">
    <div class="upload-spinner"></div>
    <div>
      <div id="actionTitle" class="upload-title">Working...</div>
      <div class="upload-sub">This may take a moment. Please don’t close this page.</div>
    </div>
  </div>
  <style>
    .upload-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.45); display: flex; align-items: center; justify-content: center; z-index: 3000; }
    .upload-dialog { background: #ffffff; border-radius: 12px; padding: 18px 22px; box-shadow: 0 10px 30px rgba(0,0,0,.25); display: flex; align-items: center; gap: 12px; min-width: 280px; }
    .upload-spinner { width: 22px; height: 22px; border: 3px solid #e5e7eb; border-top-color: var(--primary-color); border-radius: 50%; animation: upload-spin 1s linear infinite; }
    .upload-title { font-family: 'Lato', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; font-weight: 600; color: #111; }
    .upload-sub { font-size: 12px; color: #666; margin-top: 2px; }
    @keyframes upload-spin { to { transform: rotate(360deg); } }
  </style>
</div>

<script src="/js/superadmin-requests.js" defer></script>