<% 
  title = 'Register';
  headPartial = '../partials/seo/register-head';
%>
<link rel="stylesheet" href="/css/register.css" />

<div class="auth-page">
<form
  action="/auth/register?_csrf=<%= csrfToken %>"
  method="post"
  enctype="multipart/form-data"
  class="auth-form"
>
  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
  <h1>Create Account</h1>

  <% if (error) { %>
    <div class="alert alert-error"><%= error %></div>
  <% } %>

  <label for="name">Full Name</label>
  <input id="name" name="name" type="text" required />

  <label for="email">Email</label>
  <input id="email" name="email" type="email" required />
  <div id="emailError" class="error-text"></div>

  <label for="phone">Phone Number</label>
  <input id="phone" name="phone" type="tel" placeholder="+1234567890" />

  <label for="bmbyId">BMBY ID</label>
  <input id="bmbyId" name="bmby_id" type="text" placeholder="Enter your BMBY ID" required />
  <div class="field-help-text">This will be used when syncing leads with BMBY via Zapier.</div>

  <label for="password">Password</label>
  <input id="password" name="password" type="password" required />

  <label for="passwordConfirm">Confirm Password</label>
  <input id="passwordConfirm" name="passwordConfirm" type="password" required />
  <div id="passwordError" class="error-text"></div>

  <label for="areaSelect">Area</label>
  <select id="areaSelect" name="area" required>
    <option value="">-- Select Area --</option>
    <% Object.keys(areaRoles).forEach(area => { %>
      <option value="<%= area %>"><%= area %></option>
    <% }) %>
  </select>

  <label for="positionSelect">Position</label>
  <select id="positionSelect" name="position" disabled required>
    <option>Choose an area first</option>
  </select>

  <label for="registrationKey">Registration Key</label>
  <input 
    id="registrationKey" 
    name="registrationKey" 
    type="text" 
    placeholder="Enter the registration key provided by your administrator"
    required 
  />
  <div class="field-help-text">Contact an administrator to obtain the registration key</div>

  <label for="profile_picture">Profile Picture (optional)</label>
  <div class="file-help-text" id="fileHelpText">Supported formats: JPG, JPEG, PNG</div>
  <input
    id="profile_picture"
    name="profile_picture"
    type="file"
    accept="image/*"
  />
  <div class="thumb-wrapper">
    <img id="profilePreview" class="thumb" style="display:none;" />
  </div>

  <button type="submit">Register</button>

  <p>
    Already have an account? <a href="/auth/login">Log in here</a>
  </p>
</form>
</div>

<script id="area-roles" type="application/json"><%- JSON.stringify(areaRoles) %></script>
<script src="/js/register.js" defer></script>

<!-- Submitting Overlay -->
<div id="uploadOverlay" class="upload-overlay" hidden style="display:none;">
  <div class="upload-dialog">
    <div class="upload-spinner"></div>
    <div>
      <div class="upload-title">Submitting...</div>
      <div class="upload-sub">This may take a moment. Please donâ€™t close this page.</div>
    </div>
  </div>
  <style>
    .upload-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.45); display: flex; align-items: center; justify-content: center; z-index: 3000; }
    .upload-dialog { background: #ffffff; border-radius: 12px; padding: 18px 22px; box-shadow: 0 10px 30px rgba(0,0,0,.25); display: flex; align-items: center; gap: 12px; min-width: 280px; }
    .upload-spinner { width: 22px; height: 22px; border: 3px solid #e5e7eb; border-top-color: var(--primary-color); border-radius: 50%; animation: upload-spin 1s linear infinite; }
    .upload-title { font-family: 'Lato', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; font-weight: 600; color: #111; }
    .upload-sub { font-size: 12px; color: #666; margin-top: 2px; }
    @keyframes upload-spin { to { transform: rotate(360deg); } }
  </style>
</div>