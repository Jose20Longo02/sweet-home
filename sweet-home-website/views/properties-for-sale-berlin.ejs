<% useMainContainer = false %>
<% useHomeHeader = true %>
<link rel="stylesheet" href="/css/home.css" />
<link rel="stylesheet" href="/css/berlin-landing.css" />

<div id="locations-data" data-locations='<%- (typeof minifyJSON !== 'undefined' ? minifyJSON(locations) : JSON.stringify(locations)).replace(/'/g, '&#39;') %>' style="display:none"></div>

<div class="berlin-landing-page">
  <!-- 1) Hero: title, description, CTA -->
  <section class="berlin-hero" aria-labelledby="berlin-hero-title">
    <div class="berlin-hero__bg">
      <img src="/images/berlin-hero.jpg" alt="" fetchpriority="high" decoding="async">
    </div>
    <div class="berlin-hero__overlay"></div>
    <div class="berlin-hero__content">
      <h1 id="berlin-hero-title" class="berlin-hero__title">Properties for Sale in Berlin</h1>
      <p class="berlin-hero__description">Find your next home or investment in Berlin, Germany. Browse apartments, houses, and villas with expert guidance from Sweet Home.</p>
    </div>
  </section>

  <!-- 2) Search bar section (Germany default) -->
  <section id="berlin-search" class="berlin-search" aria-labelledby="berlin-search-title">
    <h2 id="berlin-search-title" class="berlin-search__title sr-only"><%= t('home.search.cta','Search Properties') %></h2>
    <form action="/properties" method="get" class="berlin-search__form">
      <div class="berlin-search__row">
        <label class="sr-only" for="country"><%= t('forms.country','Country') %></label>
        <select id="country" name="country" aria-label="<%= t('forms.country','Country') %>">
          <option value=""><%= t('forms.country','Country') %></option>
          <% Object.keys(locations).forEach(c => { %>
            <option value="<%= c %>" <%= c === 'Germany' ? 'selected' : '' %>><%= c %></option>
          <% }); %>
        </select>
        <label class="sr-only" for="city"><%= t('forms.city','City') %></label>
        <select id="city" name="city" aria-label="<%= t('forms.city','City') %>">
          <option value=""><%= t('forms.city','City') %></option>
          <% if (locations.Germany) { Object.keys(locations.Germany).forEach(ct => { %>
            <option value="<%= ct %>"><%= ct %></option>
          <% }); } %>
        </select>
        <label class="sr-only" for="neighborhood"><%= t('forms.neighborhood','Neighborhood') %></label>
        <select id="neighborhood" name="neighborhood" disabled aria-label="<%= t('forms.neighborhood','Neighborhood') %>">
          <option value=""><%= t('forms.neighborhood','Neighborhood') %></option>
        </select>
        <label class="sr-only" for="operation"><%= t('forms.operation','Operation') %></label>
        <select id="operation" name="operation">
          <option value=""><%= t('forms.anyOperation','Any Operation') %></option>
          <option value="buy" selected><%= t('forms.operations.buy','Buy') %></option>
          <option value="rent"><%= t('forms.operations.rent','Rent') %></option>
        </select>
        <label class="sr-only" for="type"><%= t('forms.propertyType','Property Type') %></label>
        <select id="type" name="type">
          <option value=""><%= t('forms.anyType','Any Type') %></option>
          <option><%= t('forms.types.apartment','Apartment') %></option>
          <option><%= t('forms.types.house','House') %></option>
          <option><%= t('forms.types.villa','Villa') %></option>
          <option><%= t('forms.types.land','Land') %></option>
        </select>
        <button type="submit"><%= t('home.search.cta','Search Properties') %></button>
      </div>
    </form>
  </section>

  <!-- 3) Featured properties: 3x3 grid, handpicked style -->
  <section class="section featured berlin-featured" aria-labelledby="recommended-heading">
    <h2 id="recommended-heading" class="berlin-featured__title">Explore Our Handpicked Properties in Berlin</h2>
    <div class="berlin-featured__grid" id="berlinRecommended">
      <% (recommendedProperties || []).forEach(property => { %>
        <%
          const photoUrl = (property.photos && property.photos[0]) ? property.photos[0] : '/img/property-placeholder.jpg';
          const size = property.size ? `${property.size} m²` : null;
          const beds = (typeof property.rooms !== 'undefined' && property.rooms !== null) ? property.rooms : null;
          const baths = (typeof property.bathrooms !== 'undefined' && property.bathrooms !== null) ? property.bathrooms : null;
          const priceText = property.price && Number(property.price) > 0 ? '€' + Number(property.price).toLocaleString('en-US') : '';
        %>
        <article class="property-card">
          <a href="/properties/<%= property.slug %>" class="property-card-link">
            <div class="img-wrap" <%= priceText ? `data-price="${priceText}"` : '' %>>
              <img src="<%= photoUrl %>" alt="<%= property.title %>" loading="lazy" decoding="async" onerror="this.src='/img/property-placeholder.jpg'">
            </div>
            <div class="meta">
              <div class="title"><%= property.title %></div>
              <% if (priceText) { %><div class="price"><%= priceText %></div><% } %>
              <div class="location">
                <span class="icon icon-16 icon-inline icon-mask icon-location" style="color: currentColor;"></span>
                <%= property.neighborhood || property.city %>, <%= property.country %>
              </div>
              <div class="features-row">
                <% if (size) { %>
                  <div class="feature">
                    <span class="icon icon-16 icon-inline icon-mask icon-size"></span>
                    <span><%= size %></span>
                  </div>
                <% } %>
                <% if (beds !== null) { %>
                  <div class="feature">
                    <span class="icon icon-16 icon-inline icon-mask icon-bed"></span>
                    <span><%= beds %> bed<%= Number(beds) === 1 ? '' : 's' %></span>
                  </div>
                <% } %>
                <% if (baths !== null) { %>
                  <div class="feature">
                    <span class="icon icon-16 icon-inline icon-mask icon-bath"></span>
                    <span><%= baths %> bath<%= Number(baths) === 1 ? '' : 's' %></span>
                  </div>
                <% } %>
              </div>
              <span class="learn-more"><%= t('properties.list.viewDetails','View details') %> →</span>
            </div>
          </a>
        </article>
      <% }); %>
    </div>
    <% if (!recommendedProperties || recommendedProperties.length === 0) { %>
      <p class="section-empty"><%= t('properties.list.noResults','No properties found.') %> <a href="/properties?country=Germany"><%= t('home.search.cta','Search Properties') %></a></p>
    <% } else { %>
      <p class="section-cta">
        <a href="/properties?country=Germany" class="btn btn-primary"><%= t('properties.list.viewAll','View all properties in Berlin') %></a>
      </p>
    <% } %>
  </section>
</div>

<script>
(function() {
  var locationsEl = document.getElementById('locations-data');
  if (locationsEl && typeof window !== 'undefined') {
    try {
      window.locations = JSON.parse(locationsEl.getAttribute('data-locations') || '{}');
    } catch (e) {}
  }
  var countrySelect = document.getElementById('country');
  var citySelect = document.getElementById('city');
  var neighborhoodSelect = document.getElementById('neighborhood');
  if (countrySelect && citySelect && neighborhoodSelect && window.locations) {
    citySelect.disabled = false;
    if (countrySelect.value === 'Germany' && window.locations.Germany) {
      Object.keys(window.locations.Germany).forEach(function(ct) {
        var opt = document.createElement('option');
        opt.value = ct;
        opt.textContent = ct;
        citySelect.appendChild(opt);
      });
    }
    countrySelect.addEventListener('change', function() {
      var country = this.value;
      citySelect.innerHTML = '<option value="">' + (document.documentElement.lang === 'de' ? 'Stadt' : document.documentElement.lang === 'es' ? 'Ciudad' : 'City') + '</option>';
      neighborhoodSelect.innerHTML = '<option value="">' + (document.documentElement.lang === 'de' ? 'Stadtteil' : document.documentElement.lang === 'es' ? 'Barrio' : 'Neighborhood') + '</option>';
      neighborhoodSelect.disabled = true;
      if (country && window.locations[country]) {
        Object.keys(window.locations[country]).forEach(function(ct) {
          var opt = document.createElement('option');
          opt.value = ct;
          opt.textContent = ct;
          citySelect.appendChild(opt);
        });
        citySelect.disabled = false;
      } else {
        citySelect.disabled = true;
      }
    });
    citySelect.addEventListener('change', function() {
      var country = countrySelect.value;
      var city = this.value;
      neighborhoodSelect.innerHTML = '<option value="">' + (document.documentElement.lang === 'de' ? 'Stadtteil' : document.documentElement.lang === 'es' ? 'Barrio' : 'Neighborhood') + '</option>';
      if (country && city && window.locations[country] && window.locations[country][city]) {
        window.locations[country][city].forEach(function(n) {
          var opt = document.createElement('option');
          opt.value = n;
          opt.textContent = n;
          neighborhoodSelect.appendChild(opt);
        });
        neighborhoodSelect.disabled = false;
      } else {
        neighborhoodSelect.disabled = true;
      }
    });
  }
})();
</script>
