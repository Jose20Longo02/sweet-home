<!DOCTYPE html>
<html lang="<%= typeof lang !== 'undefined' ? lang : 'en' %>">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %> | Sweet Home</title>
  <link rel="icon" type="image/png" href="/images/favicon.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicon.png" sizes="16x16">
  <link rel="apple-touch-icon" href="/images/favicon.png">
  <!-- Fonts: Playfair Display for headings, Lato for body -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@600;700&display=swap">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <% if (typeof headPartial !== 'undefined' && headPartial) { try { %>
    <%- include(headPartial) %>
  <% } catch (e) { /* safely ignore optional head partial errors */ } } %>
  <link rel="preload" as="style" href="/css/styles.css" />
  <link rel="stylesheet" href="/css/styles.css" />
  <link rel="preload" as="style" href="/css/variables.css" />
  <link rel="stylesheet" href="/css/variables.css" />
  <meta name="csrf-token" content="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
  <% if ((typeof GA_MEASUREMENT_ID !== 'undefined' && GA_MEASUREMENT_ID) && !(typeof currentPath !== 'undefined' && (/^\/(admin|superadmin)/).test(currentPath))) { %>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=<%= GA_MEASUREMENT_ID %>"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      // Consent Mode: analytics_storage defaults to 'granted' for proper user tracking
      // Set GA_CONSENT_DEFAULT=denied in .env if you need to implement a consent banner
      const consentDefault = '<%= GA_CONSENT_DEFAULT %>' || 'granted';
      gtag('consent', 'default', { 
        'ad_storage': 'denied',  // Always deny ad storage by default
        'analytics_storage': consentDefault  // Allow analytics for user tracking
      });
      gtag('config', '<%= GA_MEASUREMENT_ID %>');
    </script>
  <% } %>
  <% if (!(typeof currentPath !== 'undefined' && (/^\/(admin|superadmin)/).test(currentPath))) { %>
    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '1575759736952664');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=1575759736952664&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
  <% } %>
  <% if (typeof canonicalUrl !== 'undefined' && canonicalUrl) { %>
    <link rel="canonical" href="<%= canonicalUrl %>">
  <% } %>
  <% if (typeof canonicalUrl !== 'undefined' && canonicalUrl) { %>
    <link rel="alternate" hreflang="en" href="<%= canonicalUrl.replace(/:\/\//, '://').replace(/\/es\//,'/').replace(/\/de\//,'/') %>">
    <link rel="alternate" hreflang="es" href="<%= canonicalUrl.replace(/:\/\//, '://').replace(/:\/\//, '://').replace(/\/de\//,'/es/').replace(/\/en\//,'/es/').replace(/\/$/,'/').replace(/\/\/$/,'/') %>">
    <link rel="alternate" hreflang="de" href="<%= canonicalUrl.replace(/:\/\//, '://').replace(/:\/\//, '://').replace(/\/es\//,'/de/').replace(/\/en\//,'/de/').replace(/\/$/,'/').replace(/\/\/$/,'/') %>">
    <link rel="alternate" hreflang="x-default" href="<%= canonicalUrl.replace(/:\/\//, '://').replace(/\/es\//,'/').replace(/\/de\//,'/') %>">
  <% } %>
  <% if ((typeof GA_MEASUREMENT_ID !== 'undefined' && GA_MEASUREMENT_ID) && !(typeof currentPath !== 'undefined' && (/^\/(admin|superadmin)/).test(currentPath))) { %>
    <script>
      window.GA_MEASUREMENT_ID = '<%= GA_MEASUREMENT_ID %>';
    </script>
    <script src="/js/analytics.js" defer></script>
  <% } %>
  <script src="/js/main.js" defer></script>
  <script>
    // Lazy-load non-critical scripts when idle
    window.requestIdleCallback && requestIdleCallback(function(){
      [
        '/js/home.js'
      ].forEach(function(src){
        var s = document.createElement('script');
        s.src = src; s.defer = true; document.body.appendChild(s);
      });
    });
  </script>
</head>
<body class="<%= (typeof stickyFooter !== 'undefined' && stickyFooter) ? 'layout-sticky' : '' %>">
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <% const isAdmin = (typeof currentPath !== 'undefined' ? /^\/admin/.test(currentPath) : false); %>
  <% const isSuperAdmin = (typeof currentPath !== 'undefined' ? /^\/superadmin/.test(currentPath) : false); %>
  <% const isHomePage = (typeof currentPath !== 'undefined' ? currentPath === '/' : false); %>
  <%- include(isSuperAdmin ? '../partials/header-admin' : (isHomePage ? '../partials/header' : '../partials/header-main')) %>
  <main id="main-content" class="<%= (typeof useMainContainer !== 'undefined' && useMainContainer === false) ? '' : 'container' %> <%= (isAdmin || isSuperAdmin || !isHomePage) ? 'main-offset' : '' %>" role="main">
    <%- body %>
  </main>
  <% if (!(isAdmin || isSuperAdmin) && !(typeof hideFooter !== 'undefined' && hideFooter === true)) { %>
    <%- include('../partials/footer') %>
  <% } %>
</body>
</html>