<%
  const siteBaseUrl = ((typeof baseUrl !== 'undefined' && baseUrl) ? baseUrl : (process.env.APP_URL || 'https://sweethome.com')).replace(/\/$/, '');
  // Canonical URL: consolidate duplicates - strip page=1, expand UAE to UAE+Dubai when UAE has only one city
  let canonicalParams = Object.assign({}, (typeof queryParams !== 'undefined' && queryParams) ? queryParams : {});
  if (canonicalParams.page === '1' || canonicalParams.page === 1) delete canonicalParams.page;
  const f = (typeof filters !== 'undefined' && filters) ? filters : {};
  const locs = (typeof locations !== 'undefined' && locations) ? locations : {};
  if (f.country === 'UAE' && !f.city && locs.UAE && Object.keys(locs.UAE).length === 1) {
    canonicalParams.city = Object.keys(locs.UAE)[0];
  }
  const queryString = Object.keys(canonicalParams).length ? '?' + new URLSearchParams(canonicalParams).toString() : '';
  const projectListUrl = `${siteBaseUrl}/projects${queryString}`;
  const country = f.country || '';
  const city = f.city || '';
  const currentPage = typeof currentPage !== 'undefined' ? currentPage : 1;
  let listDesc = 'Browse luxury development projects in Cyprus, Dubai, and Berlin. Find your perfect real estate investment opportunity.';
  if (country && city) {
    listDesc = `Browse luxury development projects in ${city}, ${country}. Find your perfect real estate investment opportunity.`;
  } else if (country) {
    listDesc = `Browse luxury development projects in ${country}. Find your perfect real estate investment opportunity.`;
  }
  if (currentPage > 1) {
    listDesc = listDesc.replace('. Find', ` - Page ${currentPage}. Find`);
  }
%>
<meta name="description" content="<%= listDesc %>">
<link rel="canonical" href="<%= projectListUrl %>">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:title" content="<%= typeof title !== 'undefined' ? title : 'Development Projects' %>">
<meta property="og:description" content="<%= listDesc %>">
<meta property="og:url" content="<%= projectListUrl %>">
<meta property="og:site_name" content="Sweet Home">
<meta property="og:locale" content="en_US">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="<%= typeof title !== 'undefined' ? title : 'Development Projects' %>">
<meta name="twitter:description" content="<%= listDesc %>">

<!-- JSON-LD ItemList for projects (only if projects exist) -->
<% if (typeof projects !== 'undefined' && projects && projects.length > 0) { %>
<script type="application/ld+json"><%- (typeof minifyJSON !== 'undefined' ? minifyJSON({
  '@context': 'https://schema.org',
  '@type': 'ItemList',
  itemListElement: projects.map((project, idx) => ({
    '@type': 'ListItem',
    position: idx + 1,
    item: {
      '@type': 'ResidentialComplex',
      '@id': `${siteBaseUrl}/projects/${project.slug}`,
      name: project.title,
      url: `${siteBaseUrl}/projects/${project.slug}`
    }
  }))
}) : JSON.stringify({
  '@context': 'https://schema.org',
  '@type': 'ItemList',
  itemListElement: projects.map((project, idx) => ({
    '@type': 'ListItem',
    position: idx + 1,
    item: {
      '@type': 'ResidentialComplex',
      '@id': `${siteBaseUrl}/projects/${project.slug}`,
      name: project.title,
      url: `${siteBaseUrl}/projects/${project.slug}`
    }
  }))
})) %></script>
<% } %>

