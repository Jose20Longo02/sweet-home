<%
  var navLang = typeof lang !== 'undefined' ? lang : 'en';
  var propBerlin = navLang === 'de' ? '/de/immobilien-berlin-kaufen' : (navLang === 'es' ? '/es/propiedades-en-venta-berlin' : '/properties-for-sale-berlin');
  var propDubai = navLang === 'de' ? '/de/immobilien-dubai-kaufen' : (navLang === 'es' ? '/es/propiedades-en-venta-dubai' : '/properties-for-sale-dubai');
  var propCyprus = navLang === 'de' ? '/de/immobilien-zypern-kaufen' : (navLang === 'es' ? '/es/propiedades-en-venta-chipre' : '/properties-for-sale-cyprus');
%>
<header class="site-header gradient" role="banner">
  <div class="nav-container">
    <button class="menu-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-menu">
      <span></span><span></span><span></span>
    </button>

    <a href="/" class="brand-mobile" aria-label="Sweet Home">
      <img src="<%= (getActiveTheme && getActiveTheme() === 'christmas') ? '/images/Christmas%20assets/Logo%20-%20christmas.png' : '/images/Sweet Home Logo.png' %>" alt="Sweet Home" onerror="this.style.display='none'">

    </a>

    <nav class="nav-grid" aria-label="Primary">
      <a href="/projects/regions"><%= t('nav.projects','Projects') %></a>
      <div class="nav-properties-wrap">
        <button type="button" class="nav-properties-trigger" aria-haspopup="true" aria-expanded="false" aria-controls="nav-properties-menu" id="nav-properties-btn"><%= t('nav.properties','Properties') %></button>
        <div id="nav-properties-menu" class="nav-properties-menu" role="menu" aria-labelledby="nav-properties-btn" hidden>
          <a href="<%= propBerlin %>" role="menuitem"><%= t('nav.propertiesBerlin','Berlin') %></a>
          <a href="<%= propDubai %>" role="menuitem"><%= t('nav.propertiesDubai','Dubai') %></a>
          <a href="<%= propCyprus %>" role="menuitem"><%= t('nav.propertiesCyprus','Cyprus') %></a>
        </div>
      </div>
      <a href="/owners"><%= t('nav.owners','Owners') %></a>
      <a href="/" class="brand">
        <img src="<%= (getActiveTheme && getActiveTheme() === 'christmas') ? '/images/Christmas%20assets/Logo%20-%20christmas.png' : '/images/Sweet Home Logo.png' %>" alt="Sweet Home" onerror="this.style.display='none'">

      </a>
      <a href="/services"><%= t('nav.services','Services') %></a>
      <a href="/about"><%= t('nav.about','About') %></a>
      <a href="/blog"><%= t('nav.blog','Blog') %></a>
    </nav>
    <div class="lang-switcher-wrap">
      <%- include('./lang-switcher') %>
      <a href="<%= (typeof user !== 'undefined' && user) ? '/admin' : '/auth/login' %>" class="staff-pill" aria-label="Staff dashboard">
        <span class="icon" aria-hidden="true">üîê</span>
        <span>Staff</span>
      </a>
    </div>
  </div>

  <div id="mobile-menu" class="mobile-menu" aria-hidden="true">
    <nav class="mobile-links" aria-label="Mobile">
      <a href="/projects/regions"><%= t('nav.projects','Projects') %></a>
      <div class="mobile-properties-wrap">
        <button type="button" class="mobile-properties-trigger" aria-expanded="false" aria-controls="mobile-properties-list"><%= t('nav.properties','Properties') %></button>
        <div id="mobile-properties-list" class="mobile-properties-list" hidden>
          <a href="<%= propBerlin %>"><%= t('nav.propertiesBerlin','Berlin') %></a>
          <a href="<%= propDubai %>"><%= t('nav.propertiesDubai','Dubai') %></a>
          <a href="<%= propCyprus %>"><%= t('nav.propertiesCyprus','Cyprus') %></a>
        </div>
      </div>
      <a href="/owners"><%= t('nav.owners','Owners') %></a>
      <a href="/services"><%= t('nav.services','Services') %></a>
      <a href="/about"><%= t('nav.about','About') %></a>
      <a href="/blog"><%= t('nav.blog','Blog') %></a>
    </nav>
  </div>
</header>

<style>
  .site-header { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; transition: background .3s ease, box-shadow .3s ease, height .3s ease; }
  /* Fading white (30% transparency) -> fully transparent */
  .site-header.gradient { background: linear-gradient(to bottom, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.35) 55%, rgba(255,255,255,0) 100%); }
  .site-header.shrink { background: rgba(255,255,255,0.98); box-shadow: 0 2px 10px rgba(0,0,0,.06); }

  .nav-container { max-width: 1200px; margin: 0 auto; padding: 18px 24px; overflow: visible; }
  .site-header.shrink .nav-container { padding: 8px 20px; }

  /* Even distribution: 7 grid cells, middle cell is the logo */
  .nav-grid { display: grid; grid-template-columns: repeat(7, 1fr); align-items: center; gap: 0; text-align: center; }
  .nav-grid a { text-decoration: none; color: #111; font-family: 'Lato', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; letter-spacing: .2px; }
  .nav-grid a:hover { opacity: .8; }
  .nav-grid .brand { display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
  .nav-grid .brand img { height: 130px; width: auto; }
  .brand-text { font-family: 'Playfair Display', serif; font-weight: 700; font-size: 18px; letter-spacing: .5px; color: #111; }

  /* Properties dropdown (desktop) */
  .nav-properties-wrap { position: relative; display: flex; align-items: center; justify-content: center; }
  .nav-properties-trigger { display: inline-flex; align-items: center; justify-content: center; background: none; border: 0; color: #111; font-family: 'Lato', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; letter-spacing: .2px; font-size: inherit; cursor: pointer; padding: 0; text-align: center; }
  .nav-properties-trigger:hover { opacity: .8; }
  .nav-properties-menu { position: absolute; top: 100%; left: 50%; transform: translateX(-50%); margin-top: 6px; min-width: 140px; background: #fff; border: 1px solid rgba(0,0,0,.1); border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,.12); padding: 6px 0; z-index: 1100; display: flex; flex-direction: column; }
  .nav-properties-menu[hidden] { display: none !important; }
  .nav-properties-menu a { display: block; padding: 8px 16px; color: #111; text-decoration: none; text-align: left; white-space: nowrap; }
  .nav-properties-menu a:hover { background: rgba(0,0,0,.06); }

  /* Mobile properties submenu */
  .mobile-properties-wrap { display: flex; flex-direction: column; gap: 4px; }
  .mobile-properties-trigger { display: flex; align-items: center; justify-content: space-between; width: 100%; background: none; border: 0; color: #111; font-size: inherit; font-family: inherit; padding: 10px 0; text-align: left; cursor: pointer; }
  .mobile-properties-list { padding-left: 12px; display: flex; flex-direction: column; gap: 4px; }
  .mobile-properties-list[hidden] { display: none !important; }
  .mobile-properties-list a { padding: 8px 0; text-decoration: none; color: #111; }

  /* Language switcher placement */
  .lang-switcher-wrap { position: absolute; right: 16px; top: 18px; display: flex; flex-direction: row; align-items: center; gap: 8px; }
  .lang-switcher-wrap .lang-switcher { margin-left: 0; }
  .staff-pill { margin: 0; }
  @media (min-width: 901px) {
    .lang-switcher-wrap .lang-trigger,
    .lang-switcher-wrap .staff-pill { height: 36px; padding: 0 12px; align-items: center; }
  }
  /* Staff pill below language, same sizing */
  .staff-pill { display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; border: none; border-radius: 999px; background: transparent; color: #111; font-size: 13px; line-height: 1.2; text-decoration: none; margin: 0; box-shadow: none; }
  .staff-pill:hover { transform: translateY(-1px); background: rgba(17,17,17,0.04); color: #111; }
  .staff-pill .icon { font-size: 14px; }

  /* Mobile menu */
  .brand-mobile { display: none; text-decoration: none; }
  .brand-mobile img { height: 130px; width: auto; }
  .menu-toggle { display: none; background: transparent; border: 0; width: 40px; height: 40px; align-items: center; justify-content: center; }
  /* hamburger bars */
  .menu-toggle { box-shadow: none; border-radius: 0; }
  .menu-toggle span { display: block; width: 24px; height: 2px; background: #111; transition: transform .25s ease, opacity .25s ease; }
  .menu-toggle span:nth-child(2) { margin: 5px 0; }
  .menu-toggle.active span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
  .menu-toggle.active span:nth-child(2) { opacity: 0; }
  .menu-toggle.active span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }
  .mobile-menu { position: absolute; top: 100%; left: 0; right: 0; background: rgba(255,255,255,0.98); border-bottom: 1px solid #eee; display: none; }
  .mobile-menu.open { display: block; }
  .mobile-links { display: grid; gap: 10px; padding: 12px 16px; }
  .mobile-links a { text-decoration: none; color: #111; }

  @media (max-width: 900px) {
    .nav-container { display: flex; align-items: center; justify-content: center; padding: 4px 12px; position: relative; }
    .nav-grid { display: none; }
    .nav-properties-menu { left: 50%; }
    .brand-mobile { display: inline-flex; align-items: center; gap: 8px; margin: 0; line-height: 0; }
    .brand-mobile img { display: block; }
    .brand-mobile .brand-text { display: none; }
    .menu-toggle { display: inline-flex; position: absolute; right: 12px; top: 10px; background: transparent !important; border: 0 !important; box-shadow: none !important; flex-direction: column; }
    /* Move language pills to the left on mobile/tablet */
    .lang-switcher-wrap { position: absolute; left: 12px; right: auto; top: 10px; display: flex; flex-direction: column; align-items: flex-start; gap: 0; }
    .lang-switcher-wrap .lang-switcher { margin-left: 0; }
    .staff-pill { padding: 6px 10px; font-size: 12px; margin: 0; }
  }
</style>
<script>
(function() {
  var btn = document.getElementById('nav-properties-btn');
  var menu = document.getElementById('nav-properties-menu');
  if (btn && menu) {
    function open() { menu.hidden = false; btn.setAttribute('aria-expanded', 'true'); }
    function close() { menu.hidden = true; btn.setAttribute('aria-expanded', 'false'); }
    function toggle() { if (menu.hidden) open(); else close(); }
    btn.addEventListener('click', function(e) { e.stopPropagation(); toggle(); });
    document.addEventListener('click', function() { if (!menu.hidden) close(); });
    document.addEventListener('keydown', function(e) { if (e.key === 'Escape') close(); });
  }
  var mobileTrigger = document.querySelector('.mobile-properties-trigger');
  var mobileList = document.getElementById('mobile-properties-list');
  if (mobileTrigger && mobileList) {
    mobileTrigger.addEventListener('click', function() {
      var open = mobileList.hidden;
      mobileList.hidden = !open;
      mobileTrigger.setAttribute('aria-expanded', open);
    });
  }
})();
</script>

