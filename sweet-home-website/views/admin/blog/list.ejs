<% title = 'My Blog Posts' %>
<link rel="stylesheet" href="/css/admin/blog-list.css" />
<div class="admin-panel">
  <div class="admin-body">
    <main class="admin-content blog-list-page">
      <div class="admin-header">
        <div>
          <h1>My Blog Posts</h1>
          <p class="subtitle">Create and manage your articles</p>
        </div>
        <a href="/admin/dashboard/blog/new" class="btn">+ New Post</a>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Status</th>
            <th>Updated</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% if ((posts || []).length === 0) { %>
            <tr><td colspan="4">No posts yet.</td></tr>
          <% } %>
          <% (posts || []).forEach(p => { %>
            <tr>
              <td><%= p.title %></td>
              <td><%= p.status %></td>
              <td><%= new Date(p.updated_at || p.created_at).toLocaleString() %></td>
              <td>
                <a href="/admin/dashboard/blog/<%= p.id %>/edit" class="btn-link">Edit</a>
                <form action="/admin/dashboard/blog/<%= p.id %>/delete?_csrf=<%= csrfToken %>" method="post" onsubmit="return confirm('Are you sure you want to delete this blog post? This action cannot be undone.')" style="display: inline-block; margin-left: 8px;">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <button type="submit" class="btn-link btn-link--danger">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </main>
  </div>
 </div>

<!-- Uploading Overlay -->
<div id="uploadOverlay" class="upload-overlay" style="display:none;">
  <div class="upload-dialog">
    <div class="upload-spinner"></div>
    <div>
      <div class="upload-title">Processing...</div>
      <div class="upload-sub">This may take a moment. Please don't close this page.</div>
    </div>
  </div>
  <style>
    .upload-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.45); display: flex; align-items: center; justify-content: center; z-index: 9999 !important; }
    .upload-dialog { background: #ffffff; border-radius: 12px; padding: 18px 22px; box-shadow: 0 10px 30px rgba(0,0,0,.25); display: flex; align-items: center; gap: 12px; min-width: 280px; }
    .upload-spinner { width: 22px; height: 22px; border: 3px solid #e5e7eb; border-top-color: var(--primary-color); border-radius: 50%; animation: upload-spin 1s linear infinite; }
    .upload-title { font-family: 'Lato', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; font-weight: 600; color: #111; }
    .upload-sub { font-size: 12px; color: #666; margin-top: 2px; }
    @keyframes upload-spin { to { transform: rotate(360deg); } }
  </style>
</div>

<script src="/js/admin-blog.js"></script>

